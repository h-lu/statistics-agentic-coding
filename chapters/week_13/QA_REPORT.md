# Week 13 QA Report

## 四维评分

| 维度 | 分数 | 说明 |
|------|------|------|
| 叙事流畅度 | 5/5 | 结构多变，过渡自然，每个小节都有独特的引入方式，避免了模板化。从小北的业务问题开始，通过角色对话自然推进，到代码示例，再到理论解释，节奏把控很好。 |
| 趣味性 | 4/5 | 有多处"哦！"时刻：如控制碰撞变量导致系数反直觉、阿码的比喻（游戏选择触发器）、真实案例（疫情期间封锁政策）。角色互动自然，特别是老潘的实用主义风格让技术概念落地。 |
| 知识覆盖 | 5/5 | 完全覆盖了因果推断的核心知识点：三层级、因果图、d-分离、RCT、DID、IV等。代码示例可运行，从简单模拟到完整StatLab实现贯穿始终。 |
| 认知负荷 | 4/5 | 新概念4个（符合预算），通过回顾桥（p值、多重比较、回归系数等）连接前序知识。d-分离部分添加了"作弊码"表格帮助记忆，认知负荷控制得当。 |
| **总分** | **18/20** | 达到发布标准 |

## 修订历史

| 轮次 | 评分 | 主要改进 |
|------|------|---------|
| 第 1 轮 | 16/20 | 初始版本 |
| 第 2 轮 | 17/20 | 修复代码缺失 import；改进开场模式；添加 d-分离比喻；拆分 StatLab 代码 |
| 第 3 轮 | 16/20 | 新增 d-分离练习；新增疫情政策评估案例 |
| 第 4 轮 | 18/20 | 添加"相关不等于因果"代码示例；d-分离练习添加 Mermaid 可视化因果图 |
| 第 5 轮（本轮） | 18/20 | 修复 S2/S3 问题；添加 d-分离"作弊码"表格和关键点；添加"因果推断速查卡"；增强 DID 部分角色互动 |

## 技术审读问题修复

### S2 重要问题（已修复）

- [x] **第 1 节回归代码后添加警告框**：区分关联层面（P(churn|coupon)）和因果效应（P(churn|do(coupon))）
- [x] **碰撞变量 S 的生成逻辑改进**：改为更清晰的概率逻辑 `S_prob = 0.2 + 0.3 * X + 0.3 * (1 - Y)`
- [x] **ASSIGNMENT.md 任务 1 说明更准确**：改为"⚠️ 不能直接回答（需要因果识别策略：RCT 或观察研究方法如 PSM/DID/IV）"
- [x] **PSM 函数添加 positivity 假设警告**：在 docstring 中说明需要满足每个样本都有非零概率接受处理

### S3 一般问题（已修复）

- [x] **链式（中介）说明改进**：区分"总效应"和"直接效应"
- [x] **DID 公式后添加具体数值例子**：假设试点城市流失率从 30% 降到 20%，非试点从 30% 降到 25%，DID 效应 = -5%

### 认知负荷改进

- [x] **d-分离"作弊码"表格**：三种结构的对比表（不控制/控制/口诀）
- [x] **每个练习的关键点/警告**：链式（传话人）、混杂（幕后黑手）、碰撞（最大陷阱）
- [x] **因果推断速查卡**：ASCII 风格的一页纸决策框架
- [x] **DID 部分角色互动增强**：小北提出"这样做可靠吗？"，阿码回应

## 阻塞项

（无阻塞项 - 评分已达 18 分，所有维度 >= 3）

## 建议项

- [ ] StatLab 部分 `draw_causal_dag()` 返回路径可改为绝对路径
- [ ] DID 平行趋势假设检查处可添加简单的可视化代码示例

## 最难的一段

**第 3 节 d-分离与后门准则**（第 381-605 行）。这部分包含多个抽象概念（d-分离、后门准则、三种结构），需要同时理解理论、图形化表示和实践应用。特别是碰撞结构的反直觉性（控制后产生虚假相关）是学生最容易混淆的点。通过"作弊码"表格、练习题和代码示例很好地化解了这一难点。

## 最有趣的一段

**第 5 节 真实世界案例：疫情期间的政策评估**（第 794-820 行）。这个案例将 DID 方法应用于实际疫情政策评估，不仅展示了方法的应用，还通过老潘的点评揭示了观察研究的局限性："平行趋势假设可能不满足"、"其他混杂因素"、"溢出效应"。这让抽象的统计方法与现实世界的复杂性形成鲜明对比，引发学生思考因果推断的本质。

## 角色使用检查

✅ **角色出场符合要求**：
- 小北：出场多次（业务问题、困惑、震惊、提问、可靠性质疑）
- 阿码：出场多次（追问、好问题、工具变量疑问、平行趋势回应）
- 老潘：出场多次（关键提问、引导、核心概念引入、总结、指导）

✅ **角色使用推动叙事**：每个角色出场都推动了教学进程，没有装饰性出场。

## 回顾桥检查

- [x] Week 06：p 值在 RCT 假设检验中的讨论
- [x] Week 07：多重比较问题在碰撞变量控制中的呼应
- [x] Week 08：点估计与区间估计在 RCT 因果效应中的回顾
- [x] Week 09：回归系数 ≠ 因果效应的讨论

## 认知负荷检查

- 新概念数：4 个（因果推断三层级、因果图、d-分离与后门准则、观察研究中的因果推断）
- 预算上限：4 个（高级专题阶段）
- 结论：✅ 在预算内

## 代码示例检查

- [x] 所有代码块都有必要的 import 语句
- [x] 代码使用 `RANDOM_STATE = 42` 或 `np.random.seed(42)` 保证可复现
- [x] 示例代码与 examples/ 目录中的文件对应

## AI 小专栏检查

- [x] 第 1 个侧栏位于第 1-2 节后
- [x] 第 2 个侧栏位于第 3-4 节后
- [x] 参考链接指向真实可访问的资源（GitHub 项目）

## 审读记录

- consistency-editor: 验证通过，术语同步完成，角色使用正确
- technical-reviewer: 发现 12 个问题（S1: 0, S2: 4, S3: 5, S4: 3），全部 S2/S3 已修复
- student-qa: 四维评分 18/20，代码块 13 个，图片 6 张

## 结论

Week 13 章节评分 **18/20**，无阻塞项，所有维度 >= 3。经过本轮 QA 修复了 4 个 S2 问题和 2 个 S3 问题，添加了 d-分离"作弊码"表格和"因果推断速查卡"，增强了角色互动。**符合发布标准，可进入 release 流程。**
