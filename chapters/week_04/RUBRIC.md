# Week 04 评分标准（Rubric）

## 评分维度与权重

| 维度 | 权重 | 说明 |
|------|------|------|
| 相关性分析 | 25% | 方法正确、解读合理、理解"相关≠因果" |
| 分组比较 | 25% | Groupby/透视表使用正确、发现有意义 |
| 混杂识别 | 20% | 能识别潜在混杂、分层分析正确 |
| 假设清单 | 20% | 格式规范、可检验、有数据支持 |
| 代码与报告质量 | 10% | 可读性、EDA 章节完整性、可复现性 |

---

## 详细评分标准

### 1. 相关性分析（25 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 方法选择 | 8 | 正确计算 Pearson 和 Spearman，理解两者区别 | 计算正确但解释不够深入 | 只计算一种方法 | 方法选择错误 |
| 结果解读 | 10 | 正确解读相关系数大小和方向，讨论业务意义 | 解读基本正确 | 解读表面化 | 解读错误（如把相关当因果） |
| 稳健性检查 | 7 | 比较两种方法结果，讨论异常值影响 | 有比较但不够深入 | 未比较两种方法 | 未进行任何稳健性检查 |

**验证方式**：
- 检查脚本 `01_correlation_analysis.py` 的输出
- 检查 report.md 中的相关性矩阵表格
- 测试：用锚点数据验证相关系数计算是否正确

---

### 2. 分组比较（25 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| Groupby | 10 | 正确使用 groupby，计算均值/中位数/标准差/计数 | 使用正确但统计量不全 | 基本能用但有问题 | 未使用 groupby 或用法错误 |
| 透视表 | 8 | 正确使用 pivot_table，展示交叉效应 | 使用基本正确 | 透视表设计不合理 | 未使用透视表 |
| 发现解读 | 7 | 发现有意义，解读有业务逻辑 | 发现合理但解读一般 | 发现过于表面 | 未发现有效模式 |

**验证方式**：
- 检查脚本 `02_group_comparison.py` 的输出
- 检查分组统计表格和透视表
- 测试：用锚点数据验证分组计算是否正确

---

### 3. 混杂识别（20 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 混杂判断 | 8 | 正确识别潜在混杂变量，解释为什么 | 识别正确但解释不够 | 识别有误但能自圆其说 | 未识别混杂或识别错误 |
| 分层分析 | 8 | 正确进行分层分析，方法恰当 | 分层正确但层数不合理 | 分层有问题 | 未进行分层分析 |
| 结论推导 | 4 | 根据分层结果正确推导结论 | 推导基本合理 | 推导有瑕疵 | 结论与数据矛盾 |

**验证方式**：
- 检查脚本 `03_confounding_analysis.py` 的输出
- 检查分层分析表格
- 测试：用锚点数据验证分层逻辑

---

### 4. 假设清单（20 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 格式规范 | 6 | 包含所有必需字段（id, H0, H1, data_support, proposed_test, confounders, priority） | 缺少 1 个字段 | 缺少 2 个字段 | 缺少 3 个以上字段 |
| 可检验性 | 6 | H0 和 H1 互斥且可检验，描述具体明确 | 基本可检验 | H0/H1 写反或不互斥 | 假设模糊无法检验 |
| 数据支持 | 5 | 每个假设都有具体的 EDA 发现支持 | 大部分有支持 | 部分假设无支持 | 假设与数据脱节 |
| 混杂意识 | 3 | 每个假设都列出潜在混杂 | 大部分列出 | 部分列出 | 未考虑混杂 |

**验证方式**：
- 检查脚本 `04_generate_hypotheses.py` 的输出
- 检查 report.md 中的假设清单
- 验证：假设是否与 EDA 发现对应

---

### 5. 代码与报告质量（10 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 代码可读性 | 4 | 变量名清晰，逻辑分段，有适当注释 | 基本可读 | 变量名随意 | 难以阅读 |
| EDA 章节 | 4 | 包含所有必需内容，格式规范 | 缺少 1 项内容 | 缺少 2 项内容 | 缺少 3 项以上内容 |
| 可复现性 | 2 | 提供 README，代码可一键运行 | 有基本说明 | 说明不清 | 无法复现 |

**验证方式**：
- 检查 report.md 中的 EDA 章节
- 检查 README.md
- 测试：按 README 说明能否复现分析

---

## 等级标准

| 等级 | 分数区间 | 描述 |
|------|----------|------|
| **优秀（A）** | 90-100% | 所有要求完成，有额外思考。能正确区分相关与因果，混杂识别准确，假设清单完整且有深度。 |
| **良好（B）** | 80-89% | 核心要求完成，minor issues。各任务基本完成，但某些方面（如混杂分析深度、假设的业务意义）可以更深入。 |
| **合格（C）** | 70-79% | 基本完成，有明显不足。如把相关当因果、混杂识别有误、假设缺乏数据支持等。 |
| **待改进（F）** | <70% | 未完成核心要求。如缺少关键任务、代码无法运行、假设清单缺失等。 |

---

## 检查清单（供助教/自测使用）

### 相关性分析
- [ ] 计算了 Pearson 相关系数
- [ ] 计算了 Spearman 相关系数
- [ ] 比较了两种方法的结果
- [ ] 正确解读了相关系数（不当作因果）
- [ ] 讨论了业务意义

### 分组比较
- [ ] 使用了 groupby 进行分组统计
- [ ] 报告了均值、中位数、标准差、计数
- [ ] 使用了透视表展示交叉效应
- [ ] 发现了有意义的群体差异

### 混杂识别
- [ ] 识别了至少一个潜在混杂变量
- [ ] 解释了为什么这个变量可能是混杂
- [ ] 进行了分层分析
- [ ] 根据分层结果推导了正确结论

### 假设清单
- [ ] 生成了 3-5 个假设
- [ ] 每个假设都有 id、H0、H1
- [ ] 每个假设都有 data_support
- [ ] 每个假设都有 proposed_test
- [ ] 每个假设都列出了 confounders
- [ ] 每个假设都有 priority

### EDA 章节
- [ ] 包含探索目标
- [ ] 包含相关性矩阵
- [ ] 包含关键发现
- [ ] 包含分组比较结果
- [ ] 包含潜在混杂变量
- [ ] 包含假设清单
- [ ] 包含分析局限

### 代码质量
- [ ] 变量名清晰
- [ ] 有适当注释
- [ ] 代码可运行
- [ ] 提供了 README

---

## 常见扣分点

| 问题 | 扣分 | 说明 |
|------|------|------|
| 把相关当因果 | -10 | 看到相关就直接解释为"A 导致 B" |
| 未识别混杂 | -10 | 不进行分层分析就下因果结论 |
| 假设不可检验 | -8 | 假设描述模糊，无法写成 H0/H1 |
| 假设无数据支持 | -8 | 假设与 EDA 发现脱节 |
| 未考虑混杂 | -5 | 假设清单缺少 confounders 字段 |
| EDA 章节缺失 | -15 | 无 EDA 章节或章节不完整 |
| 代码无法运行 | -20 | 有语法错误或依赖缺失 |
| 未提交到 git | -5 | 无 commit 记录 |

---

## 加分项（最高 +10 分）

| 加分项 | 分值 | 说明 |
|--------|------|------|
| 交互效应探索 | +5 | 完成了任务 5，发现并解读了交互效应 |
| 多种方法对比 | +5 | 完成了任务 6，对比了三种相关性方法 |
| 伪相关发现 | +5 | 完成了任务 7，找到并解释了伪相关 |
| AI 协作练习 | +3 | 完成了 AI 代码审查并提交修复 |
| 可视化 | +2 | 用图表清晰展示关键发现 |

---

## 自动化测试锚点

以下测试用例用于验证作业实现：

```python
# tests/test_week04.py

import pandas as pd
import numpy as np

def test_pearson_correlation():
    """测试 Pearson 相关系数计算正确。"""
    df = pd.DataFrame({
        'x': [1, 2, 3, 4, 5],
        'y': [2, 4, 6, 8, 10]  # 完全线性相关
    })
    corr = df['x'].corr(df['y'], method='pearson')
    assert np.isclose(corr, 1.0)

def test_spearman_correlation():
    """测试 Spearman 相关系数计算正确。"""
    df = pd.DataFrame({
        'x': [1, 2, 3, 4, 5],
        'y': [1, 4, 9, 16, 25]  # 单调但非线性
    })
    corr = df['x'].corr(df['y'], method='spearman')
    assert np.isclose(corr, 1.0)  # Spearman 应该检测到完美单调关系

def test_groupby_mean():
    """测试 groupby 分组均值计算正确。"""
    df = pd.DataFrame({
        'group': ['A', 'A', 'B', 'B'],
        'value': [10, 20, 30, 40]
    })
    means = df.groupby('group')['value'].mean()
    assert means['A'] == 15
    assert means['B'] == 35

def test_pivot_table():
    """测试透视表创建正确。"""
    df = pd.DataFrame({
        'row': ['A', 'A', 'B', 'B'],
        'col': ['X', 'Y', 'X', 'Y'],
        'value': [1, 2, 3, 4]
    })
    pivot = pd.pivot_table(df, values='value', index='row', columns='col', aggfunc='mean')
    assert pivot.loc['A', 'X'] == 1
    assert pivot.loc['B', 'Y'] == 4

def test_stratified_analysis():
    """测试分层分析逻辑正确。"""
    df = pd.DataFrame({
        'strata': ['low', 'low', 'high', 'high'],
        'group': ['A', 'B', 'A', 'B'],
        'value': [10, 12, 100, 105]
    })
    stratified = df.groupby(['strata', 'group'])['value'].mean().unstack()
    assert stratified.loc['low', 'A'] == 10
    assert stratified.loc['high', 'B'] == 105
```

---

**评分人**：____________ **日期**：____________ **总分**：____________
