# Week 04 作业：EDA 叙事与假设清单

**本周作业目标**：从"看数字"到"讲故事"，学会用相关分析、分组比较和多变量可视化发现模式，并将观察转化为可检验假设。

**数据集**：使用 `starter_code/week_04_data.csv`（电商用户行为数据，包含用户属性和行为指标）

---

## 基础题（必做）

### 1. 相关分析练习（30 分）

**任务**：计算并解释不同类型的相关系数。

**数据字段说明**：
- `age`：用户年龄
- `time_on_site`：停留时长（秒）
- `purchase_amount`：购买金额（美元）
- `visit_count`：访问次数
- `is_returning`：是否复购（0/1）

**要求**：
1. 计算 `age`、`time_on_site`、`purchase_amount`、`visit_count` 四个数值变量的 Pearson 相关系数矩阵
2. 找出 Pearson 相关系数最高的两对变量，解释其含义
3. 对这两对变量计算 Spearman 相关系数
4. 比较Pearson 和 Spearman 的差异，说明为什么会出现这种差异（提示：用散点图检查分布形状和异常值）

**输入示例**：
```text
age,time_on_site,purchase_amount,visit_count,is_returning,source
25,180,120,3,0,search
32,420,250,7,1,direct
...
```

**输出示例**：
```markdown
## 1. 相关分析

### Pearson 相关系数矩阵
|                | age  | time_on_site | purchase_amount | visit_count |
|----------------|------|--------------|-----------------|-------------|
| age            | 1.00 | 0.12        | 0.65           | 0.08        |
| time_on_site   | 0.12 | 1.00        | 0.30           | 0.45        |
| purchase_amount| 0.65 | 0.30        | 1.00           | 0.25        |
| visit_count    | 0.08 | 0.45        | 0.25           | 1.00        |

### 最强相关分析
1. **age vs purchase_amount**：Pearson r = 0.65（强正相关）
   - Spearman r = 0.58
   - 差异原因：[你的解释]

2. **time_on_site vs visit_count**：Pearson r = 0.45（中等正相关）
   - Spearman r = 0.62
   - 差异原因：[你的解释]
```

**常见错误**：
- 只计算相关系数，不解释含义
- 没有比较 Pearson 和 Spearman 的差异
- 忽略异常值对相关系数的影响

---

### 2. 分组比较练习（30 分）

**任务**：按来源渠道分组，比较用户行为差异。

**要求**：
1. 按 `source`（渠道：direct/search/social）分组，计算各组的以下统计量：
   - `purchase_amount` 的均值、中位数、标准差
   - `is_returning` 的复购率
2. 画出分组箱线图（source × purchase_amount）
3. 按是否复购（`is_returning`）分组，计算各组的平均购买金额
4. 写出 3 条观察，每条观察都要有数据支撑

**输出示例**：
```markdown
## 2. 分组比较

### 按渠道分组的购买金额统计
| source | count | mean | median | std  |
|--------|-------|------|--------|------|
| direct | 150   | 95.2 | 88.0   | 25.3 |
| search | 180   | 121.5| 115.0  | 30.1 |
| social | 120   | 78.3 | 72.0   | 18.7 |

### 复购率
- direct：32%
- search：41%
- social：25%

### 观察
1. search 渠道的平均购买金额（121.5）比 social 高 55%
2. search 渠道的复购率最高（41%），可能是用户意图更明确
3. [第三条观察...]
```

**常见错误**：
- 只报数字，没有观察和解释
- 箱线图没有标题或标签
- 混淆均值和中位数（有偏态数据时应优先参考中位数）

---

### 3. 可视化练习（20 分）

**任务**：用多变量可视化发现隐藏模式。

**要求**：
1. 画出散点图矩阵（包含 age, time_on_site, purchase_amount, visit_count）
2. 画出相关热力图（使用 Pearson 相关系数）
3. 对比两张图，回答以下问题：
   - 热力图中显示"无相关"的变量对，在散点图矩阵中真的是无关系吗？
   - 有没有发现热力图遗漏的非线性模式？

**输出示例**：
```markdown
## 3. 多变量可视化

### 散点图矩阵
[图保存为 output/scatter_matrix.png]

### 相关热力图
[图保存为 output/heatmap.png]

### 图表对比
1. time_on_site 和 purchase_amount 的 Pearson r = 0.30（弱相关），但散点图显示...
2. age 和 visit_count 几乎无相关（r = 0.08），散点图验证了这一点
3. [你的观察...]
```

**常见错误**：
- 图表没有标题或轴标签
- 热力图不添加数值标注（`annot=True`）
- 没有对比两张图的差异

---

## 进阶题（选做）

### 4. 多数据集对比分析（20 分）

**任务**：对比两个时间段的数据模式差异。

**数据**：`starter_code/week_04_data_period1.csv` 和 `week_04_data_period2.csv`

**要求**：
1. 分别计算两个数据集的相关矩阵
2. 找出相关系数变化最大的两对变量
3. 提出一个假设：为什么这种差异会出现？（需要业务逻辑支持）

**输出示例**：
```markdown
## 4. 时间段对比

### 相关系数变化
| 变量对               | Period 1 r | Period 2 r | 变化 |
|----------------------|------------|------------|------|
| age vs purchase      | 0.65       | 0.42       | -0.23|
| time_on_site vs visit| 0.45       | 0.30       | -0.15|

### 假设
Period 2 中 age 与 purchase 的相关性减弱，可能是因为...
```

---

### 5. 时间序列分解（20 分）

**任务**：识别时间序列中的趋势和季节性。

**数据**：`starter_code/week_04_timeseries.csv`（包含 date 和 daily_sales）

**要求**：
1. 画出每日销售额的时间序列图
2. 按周聚合，画出周平均销售额
3. 识别是否存在：
   - 长期趋势（上升/下降/平稳）
   - 季节性（周末 vs 工作日）
4. 写出一个可检验假设（将在 Week 06-08 验证）

---

## 挑战题（加分）

### 6. 从 EDA 到假设清单（30 分）

**任务**：给定一个新数据集，产出完整的假设清单。

**数据**：`starter_code/week_04_challenge.csv`（包含更多变量和缺失值）

**要求**：
1. 完成数据质量检查（缺失值、异常值）
2. 进行相关分析、分组比较、多变量可视化
3. 产出一份**可检验假设清单**（至少 5 个假设），每个假设包含：
   - 观察（基于 EDA，有数据支撑）
   - 解释（业务逻辑）
   - 检验方法（指明用 Week 06-08 的哪种方法）
   - 优先级（high/medium/low）

**输出模板**：
```markdown
## 可检验假设清单

### High 优先级

**假设 1**
- **观察**：[具体观察 + 数据]
- **解释**：[业务逻辑]
- **检验方法**：[如：双样本 t 检验（Week 06）]
- **业务影响**：[为什么这个假设重要]

### Medium 优先级
...

### Low 优先级
...
```

**评分点**：
- 假设是否有数据支撑（10 分）
- 假设是否可检验（8 分）
- 解释是否有业务逻辑（7 分）
- 优先级排序是否合理（5 分）

---

## AI 协作练习（可选）

> **注意**：Week 04 处于"观察期"，本练习是可选的。如果你选择完成，请记住：**审查 AI 输出比使用 AI 生成更重要**。

### 任务：审查 AI 生成的 EDA 结论

假设你让某个 AI 工具分析 `week_04_data.csv`，它给出了以下结论：

```markdown
## AI 生成的数据分析结论

1. **年龄与购买金额高度相关**（r = 0.65），说明年龄大的用户购买力更强。建议向 35+ 用户投放更多广告。

2. **停留时长与购买金额中等相关**（r = 0.30），说明用户在网站停留越久，购买意愿越强。建议优化内容以提高停留时长。

3. **搜索渠道的平均购买金额（121.5）显著高于社交渠道（78.3）**，建议将 80% 的预算分配给搜索渠道。

4. **访问次数与购买金额的相关性较弱**（r = 0.25），说明用户访问次数不影响购买决策。
```

**请审查这段结论**，回答以下问题：

**审查清单**：
- [ ] **数字正确吗？** 用你自己的代码验证相关系数和均值
- [ ] **解释合理吗？** AI 是否把"相关"当成了"因果"？有没有更谨慎的表达方式？
- [ ] **有遗漏的上下文吗？** 如：样本量、分布形状、异常值
- [ ] **业务建议有问题吗？** 预算分配 80% 给搜索渠道是否草率？
- [ ] **有没有值得进一步验证的点？** 哪些观察应该进入假设清单？

**提交内容**：
1. 指出至少 2 个 AI 结论中的问题
2. 给出改进后的结论（用你自己的话）
3. 说明你学到了什么（关于 AI 辅助 EDA 的局限性）

**输出示例**：
```markdown
## AI 结论审查

### 问题 1：因果表述不当
**AI 原文**："年龄大的用户购买力更强"
**问题**：这是相关关系，不能直接说"更强"，而且"购买力"和"购买金额"是不同概念
**改进**："数据显示年龄与购买金额呈正相关（r = 0.65）。可能的原因包括..."

### 问题 2：预算建议缺乏数据支持
**AI 原文**："建议将 80% 的预算分配给搜索渠道"
**问题**：只看了平均购买金额，没有考虑...
**改进**："搜索渠道的客单价更高，但社交渠道可能有...需要进一步验证..."

### 学到的东西
1. AI 能快速算出统计量，但不会替你检查上下文
2. [其他学习点...]
```

---

## 提交要求

### 文件结构
```
week_04_assignment/
├── analysis.py          # 你的分析代码
├── output/              # 生成的图表
│   ├── scatter_matrix.png
│   ├── heatmap.png
│   └── ...
├── report.md            # 你的分析报告
└── ai_review.md         # AI 审查报告（如果做了 AI 练习）
```

### 报告格式（report.md）
```markdown
# Week 04 作业报告

## 1. 相关分析
[你的分析]

## 2. 分组比较
[你的分析]

## 3. 多变量可视化
[你的分析 + 图表]

## 4-5. 进阶题（如果完成）
[你的分析]

## 6. 挑战题（如果完成）
[你的假设清单]

## AI 协作练习（如果完成）
[你的审查报告]
```

### 评分标准
- **基础题**（80 分）：代码可运行 + 报告完整
- **进阶题**（20 分）：每题 10 分
- **挑战题**（30 分）：按评分点给分
- **AI 练习**（10 分）：按审查质量给分

**总分上限**：140 分

---

## 提示

1. **代码结构**：为每个题目写一个函数，便于测试
2. **图表规范**：每个图表都要有标题和轴标签
3. **报告写作**：用数字说话，每条观察都要有数据支撑
4. **时间管理**：先完成基础题，再考虑进阶和挑战

---

## 参考资源

- 如果你遇到困难，可以参考 `starter_code/solution.py` 中的示例代码（**不要直接复制**）
- Seaborn 文档：https://seaborn.pydata.org/
- Pandas groupby 指南：https://pandas.pydata.org/docs/user_guide/groupby.html

---

**最后提醒**：本周在"观察期"，重点是**建立 EDA 直觉**。AI 工具可以辅助，但判断必须由你来做。
