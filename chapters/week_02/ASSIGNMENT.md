# Week 02 作业：一页分布报告

> **提交前自查**：你的代码能运行吗？你的图表能重新生成吗？你的图表 Y 轴从 0 开始了吗？你的报告里标注了样本量吗？

---

## 作业目标

本周你将学会用描述统计和可视化把"数据长什么样"这个问题回答清楚。完成作业后，你将能够：

1. 计算并解释集中趋势指标（均值、中位数、众数），知道什么时候该用哪个
2. 计算并解释离散程度指标（方差、标准差、极差、IQR），理解"波动"的意义
3. 用直方图和箱线图观察分布形状，识别异常值
4. 判断一张图是否"诚实"：避免 Y 轴截断、面积误导等常见陷阱

---

## 数据集

使用 **Palmer Penguins** 数据集（seaborn 内置）：

```python
import seaborn as sns

penguins = sns.load_dataset("penguins")
```

数据集包含 344 只企鹅的 7 个字段：
- `species`：物种（Adelie、Gentoo、Chinstrap）
- `island`：岛屿
- `bill_length_mm`：嘴峰长度（毫米）
- `bill_depth_mm`：嘴峰深度（毫米）
- `flipper_length_mm`：鳍肢长度（毫米）
- `body_mass_g`：体重（克）
- `sex`：性别

---

## 基础练习（必做，60 分）

### 练习 1：集中趋势分析（20 分）

按物种分组，计算 `body_mass_g`（体重）的均值和中位数。

**要求**：
1. 创建一个表格，包含以下列：
   - `species`：物种
   - `mean`：均值
   - `median`：中位数
   - `count`：样本量

2. 写一段分析（3-5 句话），回答以下问题：
   - 哪个物种的体重最大？
   - 均值和中位数的差异说明什么？（提示：考虑数据分布的对称性）
   - 如果要报告"典型体重"，你选择均值还是中位数？为什么？

**输出示例**：
```
  species    mean   median  count
0  Adelie   3700.0   3700.0    152
1  Chinstrap 3733.0  3700.0     68
2  Gentoo   5076.0   5050.0    124
```

**评分点**：
- [ ] 分组计算正确，使用 `groupby` 或 `pivot_table`
- [ ] 均值和中位数计算准确，保留合理小数位
- [ ] 分析清晰，能解释"均值和中位数的差异说明什么"
- [ ] 能根据数据特点选择合适的统计量

**常见错误**：
- ❌ 只看均值就下结论，没考虑中位数
- ❌ 忘记标注样本量（count），无法判断结论的可靠性
- ❌ 分析时只说"Gentoo 最大"，没解释"为什么"

**提示**：
- 可以用 `penguins.groupby("species")["body_mass_g"].agg(["mean", "median", "count"])` 一次性计算
- 如果均值和中位数很接近，说明分布比较对称；如果差得远，说明有偏态或极端值

---

### 练习 2：离散程度分析（20 分）

计算三种企鹅体重的标准差和四分位距（IQR）。

**要求**：
1. 创建一个表格，包含以下列：
   - `species`：物种
   - `std`：标准差
   - `IQR`：四分位距（Q75 - Q25）
   - `range`：极差（max - min）

2. 写一段分析（3-5 句话），回答以下问题：
   - 哪个物种的体重波动最大？
   - 标准差和 IQR 的差异说明了什么？
   - 如果有两个物种均值相近，但一个标准差大、一个标准差小，这有什么实际意义？

**输出示例**：
```
  species     std    IQR  range
0  Adelie    458.2  650.0  2300
1  Chinstrap 389.5  525.0  1600
2  Gentoo    504.1  725.0  2650
```

**评分点**：
- [ ] 标准差计算正确，使用 `std()` 方法
- [ ] IQR 计算正确（Q75 - Q25）
- [ ] 极差计算正确（max - min）
- [ ] 分析能解释"波动"的实际意义，不只是数字

**常见错误**：
- ❌ IQR 计算错误（例如用 Q75/Q25 而不是差值）
- ❌ 只给数字不解释，没有说明"波动大意味着什么"
- ❌ 忘记比较不同物种之间的波动差异

**提示**：
- 可以用 `quantile(0.75)` 和 `quantile(0.25)` 计算 Q75 和 Q25
- 标准差和 IQR 都是描述"波动"，但标准差考虑所有点，IQR 只看中间 50%

---

### 练习 3：分布可视化（20 分）

生成两张图：直方图和箱线图，观察体重的分布形状。

**要求**：
1. **直方图**：
   - 按物种分组，绘制体重分布的直方图
   - 使用半透明颜色（alpha=0.5），让重叠部分可见
   - 标注坐标轴标题和图例

2. **箱线图**：
   - 按物种分组，绘制体重的箱线图
   - 标注坐标轴标题

3. **分析**（3-5 句话）：
   - 从直方图中你看到了什么？（例如：双峰、长尾、偏态）
   - 箱线图显示了哪些异常值？这些异常值可能是真实的还是错误？
   - 两张图各有什么优势？

**评分点**：
- [ ] 直方图按物种分组，使用半透明颜色
- [ ] 箱线图按物种分组，能清楚看到异常值
- [ ] 图表有完整的标题和标签
- [ ] 分析能结合图表内容，提到具体的观察结果

**常见错误**：
- ❌ 直方图的 bins 数量不合适（太少或太多）
- ❌ 没有使用半透明颜色，导致分组重叠看不清
- ❌ 图表缺少标题或标签

**提示**：
- 可以用 `for species in penguins["species"].unique():` 循环绘制分组直方图
- 箱线图可以用 `sns.boxplot(data=penguins, x="species", y="body_mass_g")`

---

## 进阶练习（选做，30 分）

### 练习 4：一页分布报告（20 分）

把上述练习的结果整合成一份"一页分布报告"。

**要求**：
1. 创建一个 Markdown 文件 `distribution_report.md`，包含：
   - **数据概览**：数据来源、样本量、字段说明
   - **描述统计表**：按物种分组的均值、中位数、标准差、IQR
   - **关键发现**：3-5 条你从数据和图表中发现的洞察
   - **图表**：插入直方图和箱线图的图片

2. 编写一个 Python 脚本 `generate_report.py`，自动生成这份报告

**输出示例**（`distribution_report.md` 片段）：
```markdown
# 企鹅体重分布报告

## 数据概览
- 数据来源：Palmer Penguins（seaborn 内置）
- 样本量：344 只企鹅（Adelie: 152, Chinstrap: 68, Gentoo: 124）
- 分析字段：body_mass_g（体重，克）

## 描述统计表
| 物种 | 均值 | 中位数 | 标准差 | IQR | 样本量 |
|------|------|--------|--------|-----|--------|
| Adelie | 3700 | 3700 | 458 | 650 | 152 |
...

## 关键发现
1. Gentoo 企鹅的体重显著大于其他两个物种（均值约 5076g）
2. 三种企鹅的均值和中位数都很接近，说明分布比较对称
3. Gentoo 的体重波动最大（IQR=725g），Adelie 和 Chinstrap 波动较小
...
```

**评分点**：
- [ ] 报告结构完整，包含所有必需部分
- [ ] 描述统计表数据准确，格式清晰
- [ ] 关键发现具体、有洞察，不是泛泛而谈
- [ ] Python 脚本能自动生成报告（图表 + Markdown）

**常见错误**：
- ❌ 关键发现太泛（例如"数据很有趣"），没有具体洞察
- ❌ 报告和图表分离，没有整合到一个文件
- ❌ 代码只 print 不写文件

---

### 练习 5：分布形状的数字描述（10 分）

计算所有企鹅体重的偏度和峰度，并解释它们的含义。

**要求**：
1. 计算体重的偏度和峰度
2. 解释偏度的符号说明什么（正偏态 vs 负偏态）
3. 解释峰度的数值说明什么（高峰度 vs 低峰度）
4. 对比直方图，验证你的解释是否一致

**评分点**：
- [ ] 偏度和峰度计算正确
- [ ] 能解释偏度的符号和峰度的数值含义
- [ ] 能结合直方图验证解释

**提示**：
- 可以用 `penguins["body_mass_g"].skew()` 计算偏度
- 可以用 `penguins["body_mass_g"].kurtosis()` 计算峰度
- 偏度 > 0 表示右偏（右边有长尾），偏度 < 0 表示左偏（左边有长尾）

---

## 挑战练习（选做，10 分）

### 练习 6：诚实可视化审查（10 分）

下面这段代码是某个 AI 工具生成的"对比三种企鹅体重"的可视化代码。请审查它并修复问题。

```python
# AI 生成的代码（故意包含 3 个问题）
import seaborn as sns
import matplotlib.pyplot as plt

penguins = sns.load_dataset("penguins")
mean_mass = penguins.groupby("species")["body_mass_g"].mean()

plt.figure(figsize=(6, 4))
plt.bar(mean_mass.index, mean_mass.values, color=["red", "green", "blue"])
plt.ylim(3500, 5200)  # 让差异更明显
plt.title("Penguins Weight Comparison")
plt.show()
```

**要求**：
1. **审查清单**（打钩）：
   - [ ] Y 轴从 0 开始了吗？
   - [ ] 标注了实际数值吗？
   - [ ] 标注了样本量吗？
   - [ ] 颜色选择是否合适？（是否色盲友好）
   - [ ] 图表标题是否清晰？

2. **修复代码**：写一段修复后的代码，让图表更诚实

3. **审查报告**：写一段简短说明（200 字以内），你发现了哪些问题，为什么要修复

**评分点**：
- [ ] 审查清单完整，能识别至少 3 个问题
- [ ] 修复后的代码符合"诚实可视化三原则"
- [ ] 审查报告清晰，能解释为什么要修复

**提示**：
- 诚实可视化三原则：Y 轴从 0 开始、标注实际数值、标注样本量
- 可以用 `plt.text()` 在柱子上方标注数值
- 可以用 `for i, v in enumerate(mean_mass.values):` 循环标注

---

## AI 协作练习（可选）

本周暂无 AI 协作练习。

从 Week 05 开始，我们会逐步引入 AI 审查练习，教你如何评估 AI 生成的统计分析结论是否可靠。在此之前，先建立自己的统计直觉。

如果你想提前尝试，可以让 AI 生成一段"描述三种企鹅体重差异"的结论，然后你自己审查：它有没有提到样本量？有没有提到波动？有没有误导性表述？

---

## 提交要求

### 必交内容（基础练习）

1. **`exercise1_central_tendency.py`**：集中趋势分析的代码
2. **`exercise2_dispersion.py`**：离散程度分析的代码
3. **`exercise3_plots.py`**：分布可视化的代码 + 生成的两张图片

### 选交内容（进阶/挑战练习）

4. **`exercise4_report.py`**：生成报告的代码
5. **`distribution_report.md`**：生成的一页分布报告
6. **`exercise5_skewness.py`**：偏度和峰度分析的代码
7. **`exercise6_review.md`**：诚实可视化审查报告 + 修复后的代码

### 代码质量要求

- [ ] 代码能从头到尾运行，不报错
- [ ] 有适当的注释，关键步骤有说明
- [ ] 变量命名清晰，不使用 `a`、`b`、`tmp` 这类无意义名称
- [ ] 没有硬编码的绝对路径

### 可复现性要求

- [ ] 图表保存为文件（如 `output/histogram.png`），不只是 `plt.show()`
- [ ] 如果使用随机操作，设置随机种子
- [ ] 附上一份 `README.md`，说明如何运行你的代码

---

## 需要帮助？

如果你遇到困难，可以参考 `starter_code/solution.py` 中的参考实现。但请先自己尝试，再去看答案——直接复制无法建立真正的理解。

常见问题：

**Q: 我的直方图分组太多或太少，怎么办？**
A: 可以调整 `bins` 参数。常用的做法是：`bins=int(np.sqrt(n))`，其中 n 是样本量；或者手动试试 10、20、30，选一个看起来最清楚的。

**Q: 箱线图中的异常值是怎么定义的？**
A: 默认使用 1.5×IQR 规则：小于 Q1-1.5×IQR 或大于 Q3+1.5×IQR 的点会被标记为异常值。这不是"绝对真理"，但提供了一个"值得怀疑"的阈值。

**Q: 我需要做很多图表吗？**
A: 本周重点是理解分布和离散程度，不需要做太多图。把 1-2 张图（直方图 + 箱线图）做清楚、解释清楚，就够了。

**Q: 我可以使用 AI 工具吗？**
A: 本周建议先自己动手。AI 可以帮你解释概念、调试代码，但不要直接让 AI 生成整个解决方案——你跳过了"挣扎"的过程，也就跳过了真正的学习。

---

## 评分说明

- **基础练习 60 分**：必须完成，每题 20 分
- **进阶练习 30 分**：选做，练习 4 占 20 分，练习 5 占 10 分
- **挑战练习 10 分**：选做

总分不超过 100 分。完成基础练习即可获得 60 分，达到合格线。

详细评分标准见 `RUBRIC.md`。
