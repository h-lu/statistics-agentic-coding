# Week 02 作业：一页分布报告 —— 从"一个均值"到"看见数据的形状"

> "一个均值可以骗人，一张诚实图不会。"

上周你为数据办了一张"身份证"（数据卡），知道每列是什么类型、能回答什么类型的问题。但这只是起点——老板或客户看到你的数据卡后，第一个问题往往是："**那这份数据大概长什么样？典型值在哪？波动有多大？**"

如果你只能回答"均值是 320"，你其实没有真正"看见"数据。本周作业的核心是：**用几个关键指标 + 2-3 张诚实图表，让读者在 30 秒内建立对数据的直觉。**

---

## 基础层（必做，60 分）

### 练习 1：集中趋势 —— 均值 vs 中位数 vs 众数（15 分）

选择你数据集中的**一个数值型列**（如年龄、收入、消费金额等），完成以下任务：

**任务**：

1. 计算该列的均值、中位数、众数
2. 回答：如果让你汇报"典型值"，你会用哪个？为什么？

**输入示例**：

假设你选择的是"用户月消费"列：
```
均值: 320.50
中位数: 180.00
众数: 150.00
```

**输出要求**：

一段文字说明（3-5 句话），格式如下：

```
我选择的列：[列名]
计算结果：
- 均值：[数值]
- 中位数：[数值]
- 众数：[数值]

我会选择 [均值/中位数/众数] 作为典型值，原因是：
[你的解释，至少 2 句话]
```

**评分点**：

- ✅ 正确计算三个指标（5 分）
- ✅ 能解释均值和中位数的区别（5 分）
- ✅ 选择理由合理（5 分）

**常见错误**：

- ❌ 只报数字，不解释为什么选这个
- ❌ 说"中位数更好"但不解释原因（应该提到异常值、偏斜等）
- ❌ 对分类型数据算均值（如性别编码成 0/1 后算"平均性别"）

---

### 练习 2：离散程度 —— 标准差 vs IQR（15 分）

继续使用练习 1 中选择的列，计算离散程度指标。

**任务**：

1. 计算标准差（std）和四分位距（IQR）
2. 回答：这两个指标分别回答了什么问题？在你的数据上，它们差异大吗？说明什么？

**代码框架提示**（仅供参考）：

```python
import pandas as pd

# 读取你的数据
df = pd.read_csv("your_data.csv")
col = "your_column"  # 替换成你选择的列名

# 计算标准差
std = df[col].std()

# 计算 IQR
q1 = df[col].quantile(0.25)
q3 = df[col].quantile(0.75)
iqr = q3 - q1

print(f"标准差: {std:.2f}")
print(f"IQR: {iqr:.2f} (Q1: {q1:.2f}, Q3: {q3:.2f})")
```

**输出要求**：

一段文字说明，格式如下：

```
标准差: [数值]
IQR: [数值] (Q1: [数值], Q3: [数值])

这两个指标的差异：
- 标准差告诉我们：[用你的话解释标准差的含义]
- IQR 告诉我们：[用你的话解释 IQR 的含义]

在我这份数据上，标准差 [大于/接近/小于] IQR，这说明：
[你的分析，至少 2 句话]
```

**评分点**：

- ✅ 正确计算标准差和 IQR（5 分）
- ✅ 能解释两个指标的区别（5 分）
- ✅ 能根据数值差异推断数据特征（5 分）

**常见错误**：

- ❌ 只算数字，不理解"标准差大"意味着什么
- ❌ 忘记计算 Q1 和 Q3，只写 IQR
- ❌ 对分类型数据计算标准差（应该用众数）

---

### 练习 3：分布可视化 —— 画三张图，解释每张图（20 分）

使用 seaborn/matplotlib 为练习 1 中选择的列画三张图：直方图、密度图、箱线图。

**任务**：

1. 画三张图（直方图、密度图、箱线图）
2. 为每张图写一段解释：这张图说明了什么？

**代码框架提示**：

```python
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

df = pd.read_csv("your_data.csv")
col = "your_column"

# 直方图 + 密度曲线
plt.figure(figsize=(8, 4))
sns.histplot(df[col].dropna(), kde=True, bins=30)
plt.title(f"{col} 的分布（直方图）")
plt.xlabel(col)
plt.ylabel("频数")
plt.savefig("histogram.png", dpi=150, bbox_inches="tight")
plt.show()

# 箱线图
plt.figure(figsize=(4, 4))
sns.boxplot(y=df[col])
plt.title(f"{col} 的箱线图")
plt.ylabel(col)
plt.savefig("boxplot.png", dpi=150, bbox_inches="tight")
plt.show()
```

**输出要求**：

1. 三张图片文件：`histogram.png`、`density.png`（可选，如果直方图中已包含 KDE）、`boxplot.png`
2. 一段解释文字，格式如下：

```
图 1：直方图
这张图告诉我们：
[描述分布形状：单峰/多峰？对称/偏斜？数据集中在哪个区间？]

图 2：密度图
这张图告诉我们：
[描述平滑后的分布形状，帮助你判断是否接近正态分布]

图 3：箱线图
这张图告诉我们：
[中位数在哪？IQR 多大？有没有异常点？]
```

**评分点**：

- ✅ 三张图类型正确（6 分）
- ✅ 图表有标题、坐标轴标签（6 分）
- ✅ 每张图的解释准确（8 分）

**常见错误**：

- ❌ 图表没有标题或坐标轴标签
- ❌ 箱线图看不懂，写"中间有个盒子旁边有线"
- ❌ 只说"有异常点"，不解释异常点可能是什么（录入错误 vs 真实高值）

---

### 练习 4：诚实可视化 —— 修复一张误导图（10 分）

阿码用你的数据画了一张柱状图，用来比较两个版本的转化率：A 版本 5.2%，B 版本 5.8%。为了让差异看起来更明显，他把 Y 轴的起点设成了 5%。

**任务**：

1. 模仿阿码的做法，画一张"误导图"（Y 轴从 5% 开始）
2. 再画一张"诚实图"（Y 轴从 0 开始）
3. 写一段说明：两张图的视觉差异是什么？误导图的问题在哪？

**代码框架提示**：

```python
import matplotlib.pyplot as plt

versions = ["A", "B"]
rates = [5.2, 5.8]  # 替换成你自己的数据

# 误导图：Y 轴从 5% 开始
plt.figure(figsize=(6, 4))
plt.bar(versions, rates)
plt.ylim(5, 6)  # 截断 Y 轴
plt.ylabel("转化率 (%)")
plt.title("误导图：Y 轴从 5% 开始")
plt.savefig("misleading_chart.png", dpi=150, bbox_inches="tight")
plt.show()

# 诚实图：Y 轴从 0 开始
plt.figure(figsize=(6, 4))
plt.bar(versions, rates)
plt.ylim(0, max(rates) * 1.2)
plt.ylabel("转化率 (%)")
plt.title("诚实图：Y 轴从 0 开始")
plt.savefig("honest_chart.png", dpi=150, bbox_inches="tight")
plt.show()
```

**输出要求**：

1. 两张图片：`misleading_chart.png`、`honest_chart.png`
2. 一段说明文字：

```
视觉差异：
[描述两张图给你的第一感觉差异]

误导图的问题：
[解释为什么截断 Y 轴会制造错觉]

什么情况下可以截断 Y 轴？
[说明例外场景，如数据本身不接近 0]
```

**评分点**：

- ✅ 两张图正确画出（4 分）
- ✅ 能解释截断 Y 轴的问题（4 分）
- ✅ 提到例外情况（2 分）

**常见错误**：

- ❌ 只说"截断不好"，不解释为什么
- ❌ 没有提到例外情况（如身高数据从 160cm 开始 Y 轴是可以的）

---

## 进阶层（可选，+30 分）

### 练习 5：StatLab —— 一页分布报告（30 分）

这是你本周最重要的任务：基于上周的数据卡，生成一页"分布报告"（One-Page Distribution Report）。

**任务**：

在 `statlab/report.md` 中新增一个"## 描述统计"章节，包含：

1. **核心指标摘要表**：对数值型变量列出均值、中位数、标准差；对分类型变量列出众数和频数
2. **分布图**：至少 2 张（如直方图、箱线图），每张图配一段解释
3. **诚实性说明**：说明你的图表为什么是"诚实"的（如"Y 轴从 0 开始"）

**输入示例**：

你的 `report.md` 应该长这样（Markdown 格式）：

```markdown
# [你的数据集名称] 分析报告

## 数据卡

[上周的内容...]

---

## 描述统计

### 核心指标摘要

| 变量 | 均值 | 中位数 | 标准差 |
|------|------|--------|--------|
| age | 32.5 | 30.0 | 12.3 |
| income | 45000 | 38000 | 21000 |

### 分布图

#### 月消费的分布

![月消费直方图](figures/hist_monthly_spend.png)

**说明**：月消费的均值 (320) 显著高于中位数 (180)，表明分布有右偏，存在高值异常点。典型用户的月消费在 100-300 元之间。

#### 月消费的箱线图

![月消费箱线图](figures/boxplot_monthly_spend.png)

**说明**：箱线图显示有 5 个点位于须的外侧，这些可能是高消费的 VIP 用户或数据录入错误，需要在后续清洗中进一步核实。

### 可视化诚实性

所有图表的 Y 轴均从 0 开始（或明确标注截断位置），避免制造视觉误导。箱线图保留异常点显示，不隐藏数据特征。
```

**输出要求**：

1. 更新后的 `statlab/report.md`
2. 生成的图表文件（保存在 `statlab/figures/` 目录）
3. （可选）生成报告的 Python 脚本 `statlab/scripts/generate_descriptive.py`

**评分点**：

- ✅ 核心指标摘要表完整（8 分）
- ✅ 至少 2 张分布图，有标题和标签（8 分）
- ✅ 每张图有解释说明（8 分）
- ✅ 包含可视化诚实性说明（6 分）

**提示**：

- 如果在实现过程中遇到困难，可以参考 `starter_code/solution.py`
- 但最终提交的报告必须根据你自己的数据集定制

---

## 挑战层（可选，+10 分）

### 练习 6：AI 协作练习（可选，10 分）

> **注意**：本周仍然属于"观察期"。我们不要求你使用 AI，而是希望你开始建立"审视 AI 输出"的意识。

下面这段代码是某个 AI 工具生成的，用来生成一份 EDA 摘要报告：

```python
import pandas as pd

def generate_eda_summary(df):
    """AI 生成的 EDA 摘要函数"""
    summary = {}

    for col in df.columns:
        # AI 假设所有列都算均值
        summary[col] = {
            "mean": df[col].mean(),
            "std": df[col].std()
        }

    return summary

# 使用示例
df = pd.read_csv("data.csv")
result = generate_eda_summary(df)
print(result)
```

**任务**：

审查这段代码，找出潜在问题。

**审查清单**：

- [ ] 这段代码能运行吗？有什么 bug？
- [ ] 它对数据类型做了什么假设？这个假设合理吗？
- [ ] 如果我的数据里有分类型列（如性别、城市），算"均值"有意义吗？
- [ ] 它有没有处理缺失值？
- [ ] 你能写一个让它失败的测试吗？

**输出要求**：

一段简短的审查报告，格式如下：

```markdown
# AI 代码审查报告

## 发现的问题

1. [问题描述]
   - 为什么是问题：[解释]
   - 修复建议：[建议]

2. [问题描述]
   ...

## 修复后的代码片段

[粘贴你修复后的代码，可以是伪代码]
```

**评分点**：

- ✅ 找出至少 2 个问题（5 分）
- ✅ 给出合理的修复建议（5 分）

---

## 提交清单

### 必交（基础层）

- [ ] `exercise_1_central_tendency.md`：集中趋势分析（练习 1）
- [ ] `exercise_2_dispersion.md`：离散程度分析（练习 2）
- [ ] `exercise_3_plots/`：三张图 + 解释说明（练习 3）
- [ ] `exercise_4_honest_viz/`：误导图 vs 诚实图 + 说明（练习 4）

### 进阶层（如完成）

- [ ] `statlab/report.md`：更新的分析报告（练习 5）
- [ ] `statlab/figures/`：生成的图表文件

### 挑战层（如完成）

- [ ] `ai_review.md`：AI 代码审查报告（练习 6）

---

## 常见问题与提示

### Q1：我的数据集没有合适的数值列怎么办？

**A**：可以：
- 换一个有数值列的数据集（如 Kaggle 上的"房价预测"、"泰坦尼克号"等）
- 或用教材示例数据（但长期建议用自己的数据）

### Q2：箱线图看不懂怎么办？

**A**：记住以下解读规则：
- 盒子的上下边 = Q1 和 Q3（中间 50% 数据的范围）
- 盒子中间的线 = 中位数
- "须"延伸到 1.5 倍 IQR
- 超出须的点 = 异常值（不一定是错的，需要业务判断）

### Q3：我可以用 AI 来帮我画图吗？

**A**：本周是"观察期"，重点是建立直觉。你可以：
- ✅ 用 AI 查 seaborn/matplotlib 的 API 用法
- ✅ 用 AI 解释报错信息
- ❌ 不建议直接让 AI 生成完整图表代码——你需要理解每张图在说什么

从 Week 05 开始，我们会系统性地学习"如何审查 AI 生成的统计代码"。

### Q4：练习 5 的报告太长，怎么才算"一页"？

**A**："一页"是指读者 30 秒能扫完的内容，不是严格的字数限制：
- 核心指标表：10-15 行
- 图表：2-3 张
- 每张图的解释：2-3 句话

目标是"简洁聚焦"，不是"字数少"。

---

## 评分说明

- **基础层（60 分）**：必须完成，达到基本要求即可及格
- **进阶层（30 分）**：有额外精力的话建议完成，这与你 16 周项目直接相关
- **挑战层（10 分）**：给想提前建立"AI 审查能力"的同学设计的

**截止日期**：下周上课前提交

**提交方式**：按照老师/助教的要求提交（可能通过 GitHub/Gitea、学习平台或邮件）

---

**记住：一页分布报告不是终点，是起点。它让你在 30 秒内建立对数据的直觉——后面所有推断和建模，都要基于这个直觉。**
