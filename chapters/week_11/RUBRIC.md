# Week 11 评分标准（Rubric）

## 评分维度与权重

| 维度 | 权重 | 说明 |
|------|------|------|
| 决策树建模与过拟合诊断 | 30% | 正确拟合决策树、识别过拟合、应用正则化 |
| 随机森林与 Bagging 原理 | 25% | 理解 Bagging 原理、正确拟合随机森林、与 Bootstrap 连接 |
| 特征重要性分析与陷阱 | 25% | 正确计算和解释特征重要性、识别重要性陷阱 |
| 超参数调优与模型对比 | 15% | 网格/随机搜索、多维度模型对比 |
| AI 树模型代码审查 | 5% | 识别 AI 代码中的缺失项和工程陷阱 |

---

## 详细评分标准

### 1. 决策树建模与过拟合诊断（30 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 线性回归基线正确 | 5 | 拟合正确、R²/MSE 计算准确 | 拟合基本正确 | 拟合有瑕疵 | 拟合错误 |
| 残差图分析与非线性识别 | 8 | 残差图清晰、正确识别 U 型等非线性模式 | 残差图基本正确 | 残差图有瑕疵 | 残差图缺失或错误 |
| 决策树拟合正确 | 5 | API 使用正确、参数设置合理、结果提取准确 | 拟合基本正确 | 拟合有瑕疵 | 拟合错误 |
| 过拟合诊断准确 | 7 | 正确识别训练/测试集性能差异、解释过拟合原因 | 诊断基本正确 | 诊断有瑕疵 | 未识别过拟合 |
| 正则化策略合理 | 5 | 超参数选择合理、CV 验证完整、效果显著 | 正则化基本合理 | 正则化有瑕疵 | 未应用正则化 |

**验证方式**：
- 检查 `linear_vs_tree.md` 中的残差图和性能对比
- 检查 `tree_overfitting.md` 中的过拟合诊断
- 验证正则化后的性能提升

**常见错误**：
- ❌ 未绘制残差图，直接跳到决策树（违反"先诊断问题"原则）
- ❌ 训练集 R² = 0.99，测试集只有 0.65，却说"模型很好"（未识别过拟合）
- ❌ 决策树无限生长（未设置 max_depth），导致过拟合
- ❌ 只改 max_depth，未尝试 min_samples_leaf（正则化不完整）

---

### 2. 随机森林与 Bagging 原理（25 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 随机森林拟合正确 | 6 | API 使用正确、参数设置合理（n_estimators、max_features） | 拟合基本正确 | 拟合有瑕疵 | 拟合错误 |
| Bagging 原理解释准确 | 8 | 完整解释 Bootstrap、独立训练、投票/平均三步骤 | 解释基本正确 | 解释有瑕疵 | 解释错误或缺失 |
| 与 Week 08 Bootstrap 连接正确 | 6 | 准确连接 Bootstrap（置信区间）和 Bagging（方差降低） | 连接基本正确 | 连接有瑕疵 | 未连接或连接错误 |
| 树的多样性理解准确 | 5 | 解释两个随机性来源（数据+特征）、说明多样性重要性 | 理解基本正确 | 理解有瑕疵 | 理解错误 |

**验证方式**：
- 检查 `random_forest_bagging.md` 中的 Bagging 原理解释
- 验证与 Week 08 Bootstrap 的连接分析
- 评估对"树的多样性"的理解深度

**常见错误**：
- ❌ 混淆 Bagging 和 Boosting（Bagging 并行，Boosting 串行）
- ❌ 说"树越多越好"（未讨论收益递减）
- ❌ 未提及 max_features 的作用（只说了 Bootstrap，忘了特征随机性）
- ❌ 未连接 Week 08 的 Bootstrap（知识孤立）

---

### 3. 特征重要性分析与陷阱（25 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 特征重要性计算正确 | 5 | 使用正确 API、DataFrame 结构清晰、排序准确 | 计算基本正确 | 计算有瑕疵 | 计算错误 |
| 特征重要性可视化清晰 | 5 | 水平条形图、标注完整、只显示 Top 10-15 | 可视化基本清晰 | 可视化有瑕疵 | 可视化缺失或混乱 |
| 与 Week 09 共线性连接正确 | 7 | 准确解释相关特征如何稀释重要性 | 连接基本正确 | 连接有瑕疵 | 未连接或连接错误 |
| 置换重要性实现正确 | 5 | 使用 permutation_importance、正确解读结果 | 实现基本正确 | 实现有瑕疵 | 实现错误或缺失 |
| 特征重要性解释准确 + 警告 | 3 | 正确解释（模型依赖≠因果）、包含警告 | 解释基本正确 | 解释有瑕疵 | 解释错误或无警告 |

**验证方式**：
- 检查 `feature_importance_analysis.md` 中的重要性表和可视化
- 验证与 Week 09 共线性的连接
- 评估置换重要性的实现
- 检查是否包含"特征重要性 ≠ 因果关系"警告

**常见错误**：
- ❌ 直接解释为因果（"面积重要所以扩大面积会涨价"）
- ❌ 未警告相关特征会稀释重要性（面积 vs 房间数）
- ❌ 未提及高基数类别特征的陷阱（用户 ID 被误认为重要）
- ❌ 只用不纯度重要性，未用置换重要性验证

---

### 4. 超参数调优与模型对比（15 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 网格/随机搜索实现正确 | 5 | API 使用正确、参数分布合理、CV 设置正确 | 实现基本正确 | 实现有瑕疵 | 实现错误 |
| 两种方法对比深入 | 4 | 对比性能、时间、适用场景，分析深入 | 对比基本合理 | 对比有瑕疵 | 未对比或对比错误 |
| 模型对比多维度全面 | 4 | 对比性能、可解释性、训练时间、稳定性 | 对比基本全面 | 对比有遗漏 | 对比单一维度 |
| 模型选择建议合理 | 2 | 针对不同业务场景给出合理建议 | 建议基本合理 | 建议有瑕疵 | 建议不合理 |

**验证方式**：
- 检查 `hyperparameter_tuning.md` 中的网格/随机搜索对比
- 检查 `model_comparison.md` 中的多维度对比表
- 评估模型选择建议的业务合理性

**常见错误**：
- ❌ 只对比 R²，未考虑可解释性、训练时间（单一维度）
- ❌ 说"随机森林最好"（未考虑业务场景和部署需求）
- ❌ 网格搜索 10^10 个组合（计算爆炸，应该用随机搜索）
- ❌ 未对比不同随机种子下的稳定性（忽略方差）

---

### 5. AI 树模型代码审查（5 分）

| 评分项 | 分值 | 优秀（A） | 良好（B） | 合格（C） | 不合格（F） |
|--------|------|-----------|-----------|-----------|-------------|
| 审查全面性 | 3 | 识别出所有主要缺失项（random_state、CV、调优、基线对比） | 识别出大部分问题 | 识别出部分问题 | 仅识别少量问题 |
| 问题分类合理 | 1 | 按严重性分类（高/中/低），分类准确 | 分类基本合理 | 分类有瑕疵 | 分类混乱 |
| 修正版代码正确 | 1 | 修正代码包含缺失项、可运行、符合最佳实践 | 修正代码基本正确 | 修正代码有瑕疵 | 修正代码错误 |

**验证方式**：
- 检查 `ai_tree_code_review.md` 中的审查清单
- 验证对 AI 代码缺失项的识别
- 评估修正版代码的完整性

**常见错误**：
- ❌ 未检查 AI 是否设置了 random_state（可复现性问题）
- ❌ 未检查 AI 是否划分训练/测试集（数据泄漏）
- ❌ 未检查 AI 是否使用交叉验证（评估虚高）
- ❌ 未检查 AI 是否与基线对比（无法判断模型价值）

---

## 加分/扣分项

### 加分项

| 项目 | 加分 | 说明 |
|------|------|------|
| StatLab 集成完整 | +5% | 将树模型结果正确整合到 StatLab 报告中，包含可视化 |
| 代码质量优秀 | +3% | 代码注释清晰、结构良好、可复现（固定随机种子） |
| 超额完成挑战作业 | +5% | 完成完整树模型流水线且质量优秀 |
| 深入反思 AI 协作 | +2% | AI 审查报告包含深入反思，提出有价值的改进建议 |

### 扣分项

| 项目 | 扣分 | 说明 |
|------|------|------|
| 未识别过拟合 | -10% | 训练集 R² > 0.95，测试集 < 0.70，但说"模型很好" |
| 特征重要性解释为因果 | -10% | 说"面积重要所以扩大面积会涨价" |
| 未与基线模型对比 | -8% | 直接说"随机森林最好"，未与线性回归对比 |
| 未设置 random_state | -5% | 结果不可复现 |
| 未绘制残差图 | -5% | 跳过诊断，直接建模 |

---

## 成绩等级标准

| 等级 | 总分范围 | 对应 GPA | 说明 |
|------|----------|----------|------|
| A | 90-100 | 4.0 | 优秀 |
| B | 80-89 | 3.0-3.7 | 良好 |
| C | 70-79 | 2.0-2.7 | 合格 |
| F | 0-69 | 0.0-1.7 | 不合格 |

---

## 学习目标对照

| 学习目标 | 对应任务 | 评分标准 |
|---------|---------|----------|
| 理解决策树的分裂逻辑和可解释性 | 任务 1 | 树结构可视化、分裂规则解释准确 |
| 识别决策树的过拟合问题 | 任务 2 | 训练/测试集性能对比、过拟合诊断准确 |
| 掌握正则化方法（max_depth、min_samples_leaf） | 任务 2 | 正则化策略合理、CV 验证完整 |
| 理解随机森林的 Bagging 原理 | 任务 3 | Bagging 三步骤解释准确、与 Bootstrap 连接正确 |
| 掌握特征重要性的计算和正确解释 | 任务 4 | 重要性计算正确、解释准确、包含警告 |
| 识别特征重要性的陷阱（相关性稀释、高基数特征） | 任务 4 | 与 Week 09 共线性连接正确、警告完整 |
| 掌握超参数调优方法（网格搜索、随机搜索） | 任务 5 | 两种方法实现正确、对比深入 |
| 多维度模型对比（性能、可解释性、速度） | 任务 6 | 对比表全面、选择建议合理 |
| 在 StatLab 报告中添加树模型章节 | StatLab 集成 | 树模型结果正确整合、包含可视化 |
| 审查 AI 生成的树模型代码 | AI 协作练习 | 识别缺失项、修正代码正确 |

---

## 提交检查清单

- [ ] 所有必做任务已完成
- [ ] 所有 Markdown 文档格式规范（使用清晰的章节结构）
- [ ] 残差图已绘制和解释
- [ ] 过拟合诊断已完成（训练/测试集性能对比）
- [ ] 决策树和随机森林性能已对比
- [ ] Bagging 原理已解释并与 Week 08 Bootstrap 连接
- [ ] 特征重要性已计算、可视化、正确解释
- [ ] 特征重要性陷阱已警告（相关性稀释、≠因果）
- [ ] 置换重要性已实现（可选，但有加分）
- [ ] 超参数调优已完成（进阶）
- [ ] 模型对比表已创建（多维度）
- [ ] StatLab 报告已更新（包含树模型章节）
- [ ] AI 协作练习包含审查清单和反思（可选）
- [ ] 所有代码设置了 random_state（确保可复现）
- [ ] 可视化图表清晰可读（标注完整、图例清晰）
