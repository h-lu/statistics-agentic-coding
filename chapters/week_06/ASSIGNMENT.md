# Week 06 作业：假设检验入门

> "In God we trust; all others must bring data."
> — W. Edwards Deming

本周作业要求你**完整走一遍假设检验流程**：从提出研究问题，到设定 H0/H1，到执行检验，到解释结果，到审查 AI 生成的报告。你不再只是"算出一个 p 值"，而是学会在"真实信号"和"抽样噪音"之间做出可靠的统计决策。

---

## 作业结构

| 层级 | 内容 | 建议时间 |
|------|------|----------|
| 基础作业（必做） | H0/H1 设定、p 值模拟、t 检验实战、两类错误理解 | 3-4 小时 |
| 进阶作业（选做） | 功效分析与样本量计算、多个假设的综合分析 | 1-2 小时 |
| 挑战作业（可选） | 设计并执行你自己的 A/B 测试分析 | 2-3 小时 |
| AI 协作练习（可选） | 审查 AI 生成的假设检验报告 | 1 小时 |

---

## 基础作业（必做）

### 任务 1：从研究问题到统计假设（15 分）

**目标**：将模糊的研究问题转化为可检验的 H0/H1 陈述

**步骤**：

1. 从以下研究问题中选择 2 个：
   - 新功能是否提升了用户活跃度？
   - 钻石用户的平均消费是否高于普通用户？
   - 广告点击率是否高于 5%？

2. 对每个问题写出完整的 H0 和 H1：
   - 明确参数（如均值 μ、比例 p）
   - 说明是单尾还是双尾检验，并解释理由
   - 写出检验类型（单样本 t、双样本 t、比例检验等）

3. 提交一个 Markdown 文档 `hypotheses.md`，包含：
   - 研究问题
   - H0 和 H1 的数学表达
   - 检验类型
   - 单尾/双尾选择理由

**评分标准**：
- H0/H1 设定正确（5 分）
- 检验类型选择合理（5 分）
- 单尾/双尾选择有理由（5 分）

---

### 任务 2：p 值的直观理解（20 分）

**目标**：通过模拟理解 p 值的真正含义

**步骤**：

1. 运行 `examples/01_p_value_simulation.py`
2. 观察输出：
   - scipy 计算的 p 值
   - 模拟得到的 p 值
   - 可视化图中的红色区域（极端值区域）
3. 回答以下问题：
   - p 值是 "P(H0|data)" 还是 "P(data|H0)"？有什么区别？
   - 如果 p = 0.03，这意味着"H0 为真的概率是 3%"吗？为什么？
   - 当样本量增加时，同样的均值差异会有什么变化？

4. 写一个 200 字左右的反思 `p_value_reflection.md`，总结你对 p 值的理解

**评分标准**：
- 正确解释 p 值含义（8 分）
- 正确区分两种概率解释（7 分）
- 理解样本量的影响（5 分）

---

### 任务 3：完整 t 检验流程（30 分）

**目标**：执行完整的 t 检验，包含前提假设检查、效应量计算和结果解释

**数据**：使用 `examples/06_ttest_example.py` 中生成的模拟 A/B 测试数据

**步骤**：

1. 前提假设检查：
   - Shapiro-Wilk 正态性检验
   - Levene 方差齐性检验
   - 根据结果决定使用标准 t 检验还是 Welch's t 检验

2. 执行 t 检验并记录：
   - t 统计量
   - p 值
   - 自由度

3. 计算并解释效应量（Cohen's d）：
   - 计算标准化效应量
   - 根据 Cohen's 标准解释（小/中/大效应）

4. 计算并报告 95% 置信区间

5. 写一份完整报告 `ttest_report.md`，包含：
   - 假设陈述（H0/H1）
   - 前提假设检查结果
   - 检验结果（t、p、df）
   - 效应量及其解释
   - 置信区间
   - 业务解读（这个统计结果在实际中意味着什么）

**评分标准**：
- 前提假设检查完整（8 分）
- 检验执行正确（8 分）
- 效应量计算和解释正确（8 分）
- 置信区间正确（6 分）

---

### 任务 4：两类错误与功效（20 分）

**目标**：理解第一类错误（α）和第二类错误（β）的权衡关系

**步骤**：

1. 运行 `examples/06_type12_errors.py`
2. 观察三个实验的输出：
   - 实验 1：验证第一类错误率 = α
   - 实验 2：功效随样本量的变化
   - 实验 3：α 与 β 的权衡关系（跷跷板效应）
3. 回答以下问题：
   - 如果 α = 0.05，长期来看第一类错误率是多少？
   - 如果降低 α 到 0.01，功效会怎样变化？为什么？
   - 要检测 Cohen's d = 0.5 的中等效应，每组需要多少样本？（功效目标 80%）
   - 为什么不能同时把两类错误都降到零？

4. 写一个简短总结 `errors_reflection.md`，说明你在实际场景中会如何选择 α

**评分标准**：
- 正确理解两类错误（8 分）
- 理解 α-β 权衡关系（7 分）
- 能合理选择 α 并解释理由（5 分）

---

## 进阶作业（选做）

### 任务 5：功效分析与样本量计算（25 分）

**目标**：给定效应量和目标功效，计算所需样本量

**场景**：

公司计划进行一个新的 A/B 测试，预期效应量是 Cohen's d = 0.3（小效应），管理团队希望在 80% 功效下检测出这个差异。

**步骤**：

1. 使用功效分析公式或 `examples/06_type12_errors.py` 中的函数
2. 计算以下情况下的所需样本量：
   - d = 0.3, α = 0.05, 功效 = 0.8
   - d = 0.5, α = 0.05, 功效 = 0.8
   - d = 0.3, α = 0.05, 功效 = 0.9
3. 创建一个表格 `power_analysis.md`，展示：
   - 不同效应量下的样本量需求
   - 不同功效目标下的样本量需求
   - 业务建议：给定预算限制，应该如何权衡？

**评分标准**：
- 样本量计算正确（10 分）
- 表格清晰完整（8 分）
- 业务建议合理（7 分）

---

### 任务 6：多假设综合分析（25 分）

**目标**：对同一数据集进行多个假设检验，并讨论多重比较问题

**数据**：使用 `examples/06_statlab.py` 中的数据

**步骤**：

1. 选择 3 个研究假设：
   - 均值比较（如不同用户等级）
   - 相关性检验（如收入与消费）
   - 比例检验（如性别比例）

2. 对每个假设执行完整的检验流程

3. 创建一个综合报告 `multiple_hypotheses_report.md`，包含：
   - 每个假设的检验结果（p 值、效应量）
   - 多重比较风险讨论
   - 是否需要 Bonferroni 校正？如果需要，校正后的结论是什么？
   - 最终结论：哪些假设得到支持？哪些需要更多数据？

**评分标准**：
- 检验执行正确（10 分）
- 多重比较讨论深入（10 分）
- 报告结构清晰（5 分）

---

## 挑战作业（可选）

### 任务 7：设计你自己的 A/B 测试（30 分）

**目标**：从零开始设计一个假设检验研究

**要求**：

1. **研究设计**：
   - 提出一个你关心的实际问题
   - 定义原假设和备择假设
   - 说明如何分组（实验设计）
   - 定义成功指标

2. **数据生成**（如果无法收集真实数据，可以模拟）：
   - 说明你预期的效应量（小/中/大）
   - 根据预期效应生成模拟数据
   - 确保样本量足够（使用功效分析）

3. **完整分析**：
   - 前提假设检查
   - 假设检验
   - 效应量计算
   - 置信区间
   - 功效分析

4. **报告撰写**：
   - 写一份完整的分析报告（可参考 `starter_code/solution.py` 中的格式）
   - 包含：背景、方法、结果、讨论、局限性

5. **代码提交**：
   - 提交可运行的 Jupyter Notebook 或 Python 脚本
   - 代码有清晰注释
   - 使用固定随机种子确保可复现

**评分标准**：
- 研究设计合理性（8 分）
- 分析完整性（10 分）
- 报告质量（8 分）
- 代码可读性和可复现性（4 分）

---

## AI 协作练习（可选，Week 06 开始适用）

### 任务 8：审查 AI 生成的统计报告（20 分）

**背景**：根据 `CLAUDE.md` 的 AI 融合渐进路径，Week 06 属于**"识别期"**（Week 05-08）——你需要学会审视 AI 辅助统计分析的结论。

**步骤**：

1. **获取 AI 生成的报告**：
   - 使用你喜欢的 AI 工具（如 ChatGPT、Claude 等）
   - 输入类似以下提示词：
     ```
     我有一份 A/B 测试数据，实验组 500 人，对照组 500 人。
     实验组平均活跃度 105.3，标准差 14.2。
     对照组平均活跃度 100.1，标准差 15.1。
     请帮我进行假设检验，判断新功能是否显著提升了用户活跃度。
     ```

2. **保存 AI 原始输出**，将其保存为 `ai_original_report.txt`

3. **使用审查清单**：
   - 使用 `examples/06_ai_report_checklist.py` 中的审查函数
   - 或手动对照清单检查：
     - H0/H1 是否明确？
     - p 值解释是否正确？
     - 是否报告了效应量？
     - 是否检查了前提假设？
     - 是否讨论了样本量/功效？
     - 是否有 p-hacking 迹象？
     - 相关 vs 因果是否混淆？

4. **写一份审查报告** `ai_review_report.md`，包含：
   - AI 原始报告（摘要）
   - 发现的问题列表（按严重性分类：高/中/低）
   - 你的修订版结论
   - 给 AI 的改进建议（如果让它重新生成，你会怎么提示）

5. **反思**（100 字）：
   - 你认为 AI 在这个任务上表现如何？
   - 哪些地方人类必须介入？

**评分标准**：
- 审查全面性（10 分）
- 问题分类合理（5 分）
- 修订版结论准确（5 分）

---

## StatLab 集成

**要求**：本周所有基础作业的产出应整合到你的 StatLab 报告中

**具体操作**：

1. 在你的 `report.md` 中添加"假设检验结果"章节
2. 使用 `examples/06_statlab.py` 作为参考或直接调用
3. 包含以下内容：
   - 你选择的 2 个研究假设的 H0/H1
   - 检验结果（p 值、效应量）
   - 前提假设检查结论
   - 可视化（如果有）

---

## 提交方式

1. 将所有文件放入 `chapters/week_06/assignment/` 目录
2. 文件命名规范：
   - `hypotheses.md`
   - `p_value_reflection.md`
   - `ttest_report.md`
   - `errors_reflection.md`
   - `power_analysis.md`（进阶）
   - `multiple_hypotheses_report.md`（进阶）
   - `ab_test_design.md`（挑战）
   - `ai_original_report.txt`（AI 协作）
   - `ai_review_report.md`（AI 协作）
3. 确保所有 Markdown 文档使用清晰的章节结构

---

## 作业提示

1. **不要只报告 p 值**：始终同时报告效应量和置信区间
2. **解释要业务导向**：不要只说"显著"，要解释"这对业务意味着什么"
3. **注意前提假设**：t 检验要求数据近似正态、方差齐性（或使用 Welch's）
4. **区分统计显著和实际显著**：大样本下微小差异也可能 p < 0.05，但效应量小
5. **AI 是工具，你是决策者**：AI 可以快速计算，但解释和决策必须由你来做
