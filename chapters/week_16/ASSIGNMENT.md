# Week 16 作业：从分析到交付——完整数据项目的终章

> **本周特色**：这是 16 周的最终交付，作业不是"再做一题"，而是**把过去 15 周的积累收敛成一份可复现、可审计、可展示的分析报告**。
>
> **核心目标**：从"学生作业"升级到"专业交付"——数据故事、可复现分析、结论边界。

---

## 基础练习（必做，共 80 分）

### 练习 1：重写数据故事（30 分）

小北盯着自己堆满图表的报告，陷入困惑。"我有 p 值、有 R²、有主成分载荷、有聚类中心……技术上是完整的，但为什么产品经理听完还是问'所以呢'？"

**任务**：用"问题-证据-不确定性-边界"结构重写你的 StatLab 报告。

**输入**：
- 你在 Week 01-15 逐步积累的分析报告（`report/report.md`）
- 可能包含：数据卡、描述统计、清洗日志、EDA 假设、推断检验、回归模型、分类评估、因果图、贝叶斯分析、计算专题等

**输出要求**：
在报告开头添加"数据故事概要"章节，包含四个要素：

1. **研究问题**（1-2 句话）
   - 不是"我跑了什么检验"
   - 而是"我想回答什么问题"
   - 示例："优惠券能提升消费金额吗？"（而不是"我进行了 t 检验和回归分析"）

2. **证据**（3-5 个要点）
   - 不是"p 值是多少"
   - 而是"数据支持了什么"
   - 示例：
     - 优惠券组平均消费 108 元，对照组 100 元
     - 效应量 8 元 [95% CI: 3.2, 12.8]
     - Cohen's d = 0.48（中等效应）
     - p = 0.014（统计显著）

3. **不确定性**（2-3 句话）
   - 不是"结论成立"
   - 而是"结论有多可靠"
   - 示例："95% 信心认为优惠券有效，但真实效应可能在 3.2 到 12.8 元之间"

4. **结论边界**（适用场景 + 失效条件）
   - 不是"结论完美"
   - 而是"结论在哪里不适用"
   - 示例：
     - 适用场景：结论适用于 2025 年 1-3 月的一线城市用户
     - 失效条件：购物季（如 618、双 11）用户行为变化，结论可能失效

**评分点**：
- [ ] 研究问题明确（5 分）
- [ ] 证据包含效应量 + 置信区间 + p 值（8 分）
- [ ] 不确定性量化（置信区间或标准误）（7 分）
- [ ] 结论边界包含适用场景和失效条件（10 分）

**常见错误**：
- ❌ 只写"p < 0.05，结论显著"（没有效应量和置信区间）
- ❌ 只写"结论可靠"（没有不确定性的量化表达）
- ❌ 没有写结论边界（过度承诺）
- ❌ 证据堆砌技术细节（"我们进行了 t 检验、计算了 Cohen's d、验证了正态假设"），而不是说"数据支持了什么"

**提示**：
- 如果你在写"我进行了 XXX 分析"，停下来——你在讲技术细节，不是数据故事
- 如果你在写"结论显著"，停下来——补充效应量和置信区间
- 如果你没写"结论在哪里不适用"，停下来——这是最重要的部分

---

### 练习 2：添加可复现章节（30 分）

老潘走过来，看了一眼你的 Jupyter Notebook。"能跑是第一步，但**可复现 ≠ 能跑**。"

**任务**：为你的报告添加"可复现分析"章节，确保换一台机器、换一个人，用同样的数据和代码，能得到同样的结论。

**输入**：
- 你的分析脚本或 Notebook
- 你的依赖环境（可能散落在多个 `pip install` 命令中）

**输出要求**：
在报告末尾添加"可复现分析"章节，包含四个要素：

1. **依赖安装**（requirements.txt 内容）
   - 明确每个包的版本（用 `==` 固定版本）
   - 示例：
     ```text
     numpy==1.26.4
     pandas==2.2.1
     scipy==1.13.0
     scikit-learn==1.5.0
     ```

2. **固定随机性**
   - 说明所有分析使用的随机种子
   - 示例："所有分析使用固定随机种子 `RANDOM_SEED = 42`"

3. **数据版本记录**
   - 数据来源（哪里下载的、何时下载的）
   - 数据版本（日期或版本号）
   - 示例：
     - 数据来源：`data/user_behavior_20250315.csv`
     - 数据版本：2025-03-15

4. **运行分析**
   - 从零开始运行的完整命令
   - 示例：
     ```bash
     git clone https://github.com/yourusername/statlab-project.git
     cd statlab-project
     python scripts/run_full_analysis.py
     ```

**评分点**：
- [ ] 依赖版本明确（用 `==` 固定版本）（8 分）
- [ ] 固定随机性说明（5 分）
- [ ] 数据版本记录（来源 + 日期）（7 分）
- [ ] 运行命令完整可执行（10 分）

**常见错误**：
- ❌ 依赖版本不明（`pandas` 而不是 `pandas==2.2.1`）——不同机器安装不同版本，结果不一致
- ❌ 没有固定随机种子——每次跑模型结果不同，无法验证性能
- ❌ 数据来源不清（`data.csv` 而不是"2025-03-15 从内部数据库导出"）——数据更新后无法回溯当时的分析
- ❌ 运行命令不完整（缺少 `git clone`、`cd`、虚拟环境激活等步骤）

**提示**：
- 用 `pip freeze > requirements.txt` 生成完整的依赖列表（然后手动清理不需要的包）
- 在代码开头添加 `np.random.seed(42)` 和 `RANDOM_SEED = 42`
- 在数据文件名中包含日期（如 `user_behavior_20250315.csv`）
- 写一个 `run_full_analysis.py` 脚本，从数据加载到报告生成一步到位

---

### 练习 3：写出结论边界（20 分）

阿码兴冲冲地跑来告诉你："我的模型 R² 是 0.75！"

老潘看了一眼她的报告："不错，但**结论边界在哪里？**"

"R² 只说明'模型在训练集上的解释力'，"老潘说，"不说明'模型在新场景下仍然有效'。"

**任务**：为你的主要结论写出完整的结论边界。

**输入**：
- 你在 Week 01-15 得到的分析结论（可能是 p 值、R²、AUC、系数估计等）

**输出要求**：
在报告的"结论"章节添加"结论边界"小节，包含四个要素：

1. **假设前提**（1-2 句话）
   - 结论成立的前提是什么？
   - 示例：
     - "假设数据是 MCAR（基于 Week 03 诊断）"
     - "假设线性关系成立（基于 Week 09 残差诊断）"

2. **适用场景**（1-2 句话）
   - 结论可以推广到什么场景？
   - 示例："结论适用于 2025 年 1-3 月的一线城市用户"

3. **失效条件**（2-3 句话）
   - 结论在哪里可能不成立？
   - 示例：
     - "购物季（如 618、双 11）用户行为变化，结论可能失效"
     - "在新用户群上可能失效（冷启动问题）"

4. **未来工作**（1-2 句话）
   - 如何改进结论？
   - 示例："未来可收集更多二线城市数据，测试结论的普适性"

**评分点**：
- [ ] 假设前提明确（4 分）
- [ ] 适用场景具体（4 分）
- [ ] 失效条件诚实（6 分）——这是最重要的部分
- [ ] 未来工作可执行（6 分）

**常见错误**：
- ❌ 只写"不足"（"样本量小"、"数据不完美"），而不是"假设前提、适用场景、失效条件"
- ❌ 不愿写失效条件（怕暴露缺陷）——这恰恰是读者最需要知道的
- ❌ 失效条件过于笼统（"结论可能不适用于其他情况"）——没有说明"什么情况"
- ❌ 未来工作不切实际（"收集无限多的数据"）——没有具体可执行的改进方向

**提示**：
- 问自己："如果有人在我的数据之外的场景下用这个结论，会在哪里出错？"
- 从 Week 09 的残差诊断翻译："QQ 图偏离直线" → "结论不适用于极端值场景"
- 从 Week 13 的因果图翻译："无未观测混杂假设" → "如果存在未观测混杂，结论可能失效"
- 从 Week 12 的伦理审查翻译："模型在女性群体上性能较差" → "结论不适用于性别决策场景"

---

## 进阶练习（选做，共 20 分）

### 练习 4：展示材料准备（20 分）

周五下午，产品经理推门进来："小北，下周就是期末展示了。你能准备一下吗？"

小北慌了："准备……就是准备 PPT 吧？"

"不，"产品经理说，"你要在 10-15 分钟内讲清楚：**你在回答什么问题、你的证据有多强、你的结论有多不确定、你的结论在哪里不适用**。"

**任务**：从你的报告生成 10-15 分钟的展示材料。

**输入**：
- 你在练习 1-3 中完善后的 StatLab 报告
- 可能包含 50-100 页的技术细节

**输出要求**：
生成展示材料（Markdown 幻灯片 `presentation/slides.md`），采用四段式结构：

1. **开场（1 分钟）**
   - 研究问题：不是"我做了什么分析"，而是"我想回答什么问题"
   - 背景 + 数据 + 方法（各 1 句话）
   - 示例：
     - **优惠券能提升消费金额吗？**
     - 背景：公司计划全面上线优惠券
     - 数据：2025 年 1-3 月一线城市用户
     - 方法：A/B 测试 + 效应量估计

2. **证据（5 分钟）**
   - 关键发现：不是"所有图表"，而是"支持结论的关键图表"
   - 最多 1-2 张图 + 2-3 个数字
   - 示例：
     - **优惠券组平均消费 108 元，对照组 100 元**
     - 效应量 8 元 [95% CI: 3.2, 12.8]
     - Cohen's d = 0.48（中等效应）
     - （放一张箱线图或分布图）

3. **不确定性与边界（3 分钟）**
   - 结论有多可靠：置信区间、p 值
   - 结论在哪里不适用：来自练习 3 的结论边界
   - 示例：
     - 95% 信心认为优惠券有效（p = 0.014）
     - 结论仅适用于 1-3 月一线城市数据

4. **行动建议（2 分钟）**
   - 所以呢：不是"未来工作"，而是"决策者该怎么做"
   - 示例：
     - **短期**：在一线城市全面上线优惠券
     - **长期**：收集二线城市数据，测试结论普适性

**评分点**：
- [ ] 开场讲清楚研究问题（4 分）
- [ ] 证据聚焦关键发现（不放所有图表）（5 分）
- [ ] 不确定性与边界各占一半时间（5 分）
- [ ] 行动建议具体可执行（4 分）
- [ ] 总页数控制在 10-15 页（每页 1 分钟左右）（2 分）

**常见错误**：
- ❌ 技术细节过多（"第 3 页：我们进行了 t 检验、计算了 Cohen's d、验证了正态假设"）——10-15 分钟不够，决策者听不懂
- ❌ 缺少边界讨论（"结论可靠，建议全面上线"）——没说"结论仅适用于一线城市"、"1-3 月数据"
- ❌ 结构不清晰（"第 1 页：数据加载；第 2 页：数据清洗；第 3 页：描述统计"）——没有"问题-证据-不确定性-边界"的故事线
- ❌ 时间超时（想讲所有 50 页报告的内容）——严格控制在 10-15 分钟，技术细节留给 Q&A 或报告附录

**提示**：
- 展示不是"讲所有技术细节"，而是"讲一个完整的故事"
- 展示是"预告片"，报告是"完整电影"——你用展示吸引他们，用报告说服他们
- 展示前练习，严格控制时间：开场 1 分钟、证据 5 分钟、不确定性与边界 3 分钟、行动建议 2 分钟
- 每页幻灯片只放 1 个核心观点 + 1 张图或 2-3 个要点
- 技术细节（检验方法、前提检查、样本量计算）放在"附录"页，只在 Q&A 时展开

---

## AI 协作练习（可选，不占分）

> **Week 13-16 是主导期**：AI 作为结对分析伙伴。学生主导研究问题、假设与解释边界，AI 辅助实现对照实验与报告润色。

### 练习 5：审查 AI 生成的数据故事（可选）

小北说："我让 ChatGPT 帮我写数据故事，它生成的总结比我写的还好。那我还学什么？"

老潘："**AI 可以生成'看起来像总结的文字'，但它不会'替你判断'**。"

**任务**：审查下面这段 AI 生成的"数据故事"，找出至少 3 个问题并修复。

**输入**（AI 生成的数据故事）：

> **数据故事概要（AI 生成）**
>
> ### 研究问题
>
> 我们对优惠券效果进行了全面的分析，使用了多种统计方法来评估其效果。
>
> ### 证据
>
> 我们进行了 t 检验（p=0.014）、计算了 Cohen's d（0.48）、验证了正态假设（Shapiro-Wilk p>0.05），所有结果表明优惠券显著提升消费。模型解释了 75% 的方差，效果非常好。
>
> ### 不确定性
>
> 所有检验都显著，结论可靠，建议立即全面上线优惠券。
>
> ### 结论边界
>
> 未来可以收集更多数据，进一步提升结论的可靠性。

**审查清单**：
- [ ] 它回答的问题和你真正想问的问题一致吗？
- [ ] 它说明了检验的前提假设吗？（独立性/正态性/方差齐性等）
- [ ] 它有把效应量/区间估计写出来吗？还是只谈 p-value？
- [ ] 有没有过度承诺？（"结论可靠"、"立即全面上线"）
- [ ] 它有没有把"相关"写成"因果"？（如果有因果推断，需要因果图支持）
- [ ] 有没有技术堆砌？（"我们进行了 t 检验、计算了 Cohen's d、验证了正态假设"）
- [ ] 结论边界具体吗？还是只有空泛的"未来工作"？

**输出要求**：
1. 列出你发现的至少 3 个问题（每个 1-2 句话说明为什么是问题）
2. 提供修复后的数据故事（用你自己的话重写）

**提示**：
- AI 的陷阱 1：过度承诺（"结论可靠，建议立即全面上线"）——没有说效应量多大、不确定性如何、在什么场景下有效
- AI 的陷阱 2：技术堆砌（"我们进行了 t 检验、计算了 Cohen's d、验证了正态假设"）——决策者听不懂"p 值和 Cohen's d 是什么"
- AI 的陷阱 3：缺乏边界（"结论可靠，建议立即全面上线"）——没有说"样本仅来自一线城市"、"数据仅来自 1-3 月"、"结论可能不适用于购物季"

**提交**：
- 修复后的数据故事 + 你发现了哪些问题的简短说明

---

## 提交要求

### 必做部分（基础 + 进阶）

1. **数据故事概要**（练习 1）
   - 文件：`report/report_final.md`（在原报告基础上添加"数据故事概要"章节）
   - 或提交：显示"数据故事概要"章节的截图

2. **可复现分析章节**（练习 2）
   - 文件：`report/report_final.md`（在报告末尾添加"可复现分析"章节）
   - 附加：`requirements.txt`（依赖版本明确）
   - 或提交：显示"可复现分析"章节的截图

3. **结论边界**（练习 3）
   - 文件：`report/report_final.md`（在"结论"章节添加"结论边界"小节）
   - 或提交：显示"结论边界"小节的截图

4. **展示材料**（练习 4，选做）
   - 文件：`presentation/slides.md`（Markdown 幻灯片）
   - 或提交：导出为 PDF/PPT 的展示材料

### 可选部分（AI 协作练习）

5. **AI 数据故事审查报告**（练习 5）
   - 文件：`week_16_ai_review.md`（包含 3 个问题 + 修复后的数据故事）

### 格式要求

- Markdown 文件用 UTF-8 编码
- 代码块用三个反引号包裹并标注语言（` ```python `、` ```bash `）
- 图片用相对路径引用（如 `![箱线图](figures/boxplot.png)`）

---

## 常见问题

### Q1：我的报告已经有 50 页了，还要重写吗？

**A**：不用全部重写。只需在报告开头添加"数据故事概要"章节（1 页），在末尾添加"可复现分析"章节（1 页），在"结论"章节添加"结论边界"小节（1-2 段话）。这是"添加"，不是"重写"。

### Q2：我的数据没有随机分配，能写"因果结论"吗？

**A**：不能。没有随机分配，你只能报告"相关"，不能报告"因果"。如果你想讨论因果，需要用 Week 13 的因果图明确假设（如"无未观测混杂"），并在结论边界中写明"因果结论依赖于'无未观测混杂'假设"。

### Q3：我的模型 R² 很低（0.3），还能提交吗？

**A**：可以。**结论边界不是为了暴露缺陷，而是为了管理预期**。你可以写："模型解释了 30% 的方差，但这已足以支持'优惠券有效'的结论（效应量 8 元，p=0.014）。未解释的 70% 方差可能来自用户个体差异、季节性等因素，这些是未来工作的方向。"

### Q4：我没有真实的 StatLab 项目，可以用示例数据吗？

**A**：可以。你可以用公开数据集（如 Titanic、Iris、Boston 房价）完成作业。重点是展示"数据故事、可复现分析、结论边界"的结构，不是数据本身。

### Q5：展示材料可以用 PPT 吗？

**A**：可以。但建议先用 Markdown 写（方便版本控制和 diff），再用工具（如 Marp、Pandoc）转换为 PDF/PPT。评分标准是"结构清晰"，不是"工具炫酷"。

---

## 学习检查清单

提交前，请自测：

- [ ] 我能区分"技术堆砌"和"数据故事"（前者讲"我跑了什么检验"，后者讲"数据支持了什么"）
- [ ] 我能区分"p 值"和"结论成立的概率"（p 值是"在 H0 为真时看到当前数据的概率"，不是"H0 为假的概率"）
- [ ] 我能区分"置信区间"和"预测区间"（前者是"总体均值的区间"，后者是"单个预测值的区间"）
- [ ] 我能写出完整的可复现章节（依赖、随机性、数据版本、运行命令）
- [ ] 我能区分"能跑"和"可复现"（前者是"在我机器上能跑"，后者是"换一台机器也能得到同样结论"）
- [ ] 我能写出完整的结论边界（假设前提、适用场景、失效条件、未来工作）
- [ ] 我能区分"暴露缺陷"和"管理预期"（前者是"只写不足"，后者是"告诉读者能信任到什么程度"）
- [ ] 我能准备 10-15 分钟的展示材料（开场、证据、不确定性与边界、行动建议）
- [ ] 我能区分"报告"（完整记录）和"展示"（故事摘要）
- [ ] 我理解从"会跑代码"到"会提问题、会决策、会讲故事"的转变

---

## 附加资源

### 如果你遇到困难

- **参考实现**：`starter_code/solution.py`（只实现基础作业要求，不覆盖进阶/挑战部分）
- **示例报告**：`examples/03_add_story_to_report.py`（添加数据故事）
- **可复现模板**：`examples/04_add_reproducibility_to_report.py`（添加可复现章节）
- **展示模板**：`examples/02_presentation_template.py`（生成展示材料）

### 工具推荐

- **Markdown 转 PDF/PPT**：
  - Marp: https://marp.app/（推荐，支持语法高亮和图表）
  - Pandoc: https://pandoc.org/（功能强大，但配置复杂）

- **依赖管理**：
  - `pip freeze > requirements.txt`（生成依赖列表）
  - `pip-tools`（更现代的依赖解析）

- **版本控制**：
  - `git tag v1.0-final`（标记最终版本）
  - `git archive`（导出干净的项目包）

### 延伸阅读

- **数据故事**：Nathan Yau 的《Data Points: Visualization That Means Something》
- **可复现研究**：Gandrud 的《Reproducible Research with R and RStudio》（方法论通用）
- **结论边界**：Gelman 等《Regression and Other Stories》的"Limitations"章节
- **展示技巧**：Nolan 的《Teaching Statistics: A Bag of Tricks》的"Presenting Data"章节

---

**最后提醒**：Week 16 不是终点，而是起点——你已经从"会跑代码"成长为"会提问题、会决策、会讲故事"。未来无论遇到什么数据问题，记住四个核心问题：**我在回答什么？我的证据有多强？我的结论有多不确定？我的结论在哪里不适用？**
