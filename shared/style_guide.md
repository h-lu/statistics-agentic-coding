# 行文与格式风格指南

## 总体风格

- 面向初学者：不默认读者知道"为什么要这样做"。
- 小步快跑：每节只讲一个主点，配一个最小例子。
- 工程化：每个重要结论都可验证（tests 或 anchors）。
- **叙事优先**：像写故事一样写教材，不是在填模板。

## 写作口吻与节奏（反"模板感/AI味"）

目标：读起来像真人老师写的教材，而不是"模板填空"。

**详细的好/坏范例见 `shared/writing_exemplars.md`**——所有写正文的 agent 在动笔前必须读。

### 核心节奏要求

- **场景开头**：每节用一个具体情境、问题或从上一节的自然过渡开头。绝不用"在本节中，我们将…"。
- **问题驱动**：先让读者感受到"我需要解决这个问题"，再引出概念。概念是答案，不是前提。
- **句子长短交替**：长句解释背景，短句敲定结论。"所以记住：`input()` 返回的永远是字符串。"
- **段落优先于列表**：能用 2-3 句话说清楚的事，不要拆成 bullet list。连续列表不超过 5 条。
- **过渡要自然**：节与节之间不能只靠 `---` 分隔。收束当前节时自然带出下一节的需求。

### 每节必须覆盖的要素（但形式灵活）

每节需要自然地包含以下内容，但**不要求使用固定的子标题模式**：

1. 读者为什么需要这个概念（动机）
2. 至少一个可运行的代码示例
3. 至少一个错误场景（在叙事中自然出现）
4. 本节与前后节的连接

### 写法示范（before / after）

**❌ 坏：概念先行 + bullet 小结**

> ## 变量与赋值
>
> 变量的作用就是给数据"贴标签"。
>
> ```python
> name = "Alice"
> ```
>
> ### 小结
> - 变量是数据的标签
> - 用 `=` 赋值
> - 变量名区分大小写

**✅ 好：场景驱动 + 叙述收束**

> ## 让程序记住东西
>
> 上一节你让 Python 说了 Hello——但说完就忘了。如果你想先问用户叫什么，再用名字打招呼呢？
>
> ```python
> name = input("你叫什么？")
> print("你好，" + name)
> ```
>
> `name` 就是一个变量——你给一个值取了个名字，后面的代码随时可以用。
>
> 现在你的程序能记东西了。下一个问题：如果记住的是数字，你能拿它做运算吗？

### 禁止事项

- 反复使用同一种开场句式（如每节都"在本节中…"）
- 每节都用相同的子标题结构（如"最小正例""常见错误""小结"）
- 连续 6+ 条 bullet list
- 元话语（"作为一个 AI…""接下来我会…"）
- 说教标签（"注意：""重要提示：""关键点："）
- 夸大 AI 能力或给出未经验证的事实

## 贯穿案例（每章必须）

每章围绕一个渐进式小项目展开。详见 `shared/writing_exemplars.md` 的范例 5。

要求：
- 每节结束时，读者手里的项目都是可运行的
- 每节在上一节基础上推进一步
- 章末读者拿到一个有意义的"小成果"

## PyHelper 超级线（每章必须）

除了每周独立案例，每章还需要一节 `## PyHelper 进度`，推进全书贯穿项目。详见 `shared/book_project.md`。

要求：
- 放在最后一个知识点之后、小结之前
- 代码必须在上周基础上增量修改
- 占正文 20-30%，不要喧宾夺主

## 循环角色（每章必须）

全书使用 3 个循环角色（小北、阿码、老潘）增强代入感。详见 `shared/characters.yml`。

要求：
- 每章至少出场 2 次
- 角色用来制造对话感和多视角，不是装饰
- 角色性格前后一致（由 `consistency-editor` 检查）

## 回顾桥（非 Week 01 必须）

在新内容中自然引用前几周学过的概念。详见 `CLAUDE.md` 的"认知负荷预算"章节和 `shared/concept_map.yml`。

要求：
- 不是生硬的"复习"，而是在新场景下让旧概念再次出场
- 数量参考：入门阶段至少 2 个/周，进阶阶段至少 2 个/周，实战阶段至少 3 个/周

## 章首导入（每章必须）

每章标题之后、学习目标之前，必须包含两个导入元素：**引言格言**和**时代脉搏**。目的是给读者一个"仪式感"和时代感，让每章的开始不是干巴巴的学习目标列表。

### 引言格言

与本章核心主题相关的名人名言、编程格言或技术名句。

格式要求：
- 使用 Markdown blockquote + 作者署名
- 可以是英文原文（附中文翻译）或中文原句
- 选择标准：与本章要学的**具体技能/概念**有共鸣，不要泛泛的鸡汤

```text
> "Talk is cheap. Show me the code."
> — Linus Torvalds
```

### 时代脉搏

紧跟格言之后的 200-300 字导入段落，将近 1-2 年的 AI/技术动态与本章内容自然衔接。

要求：
- **场景化**：不要写"AI 很重要"这种空话，用具体事件或数据开头
- **与本章强关联**：必须落到本章要学的具体概念上（不是泛泛的"学编程很重要"）
- **自然过渡**：最后一句引出"所以这周我们来学…"
- **不加标题**：直接写段落文字，不加 `##` 标题（它是正文的一部分，不是独立板块）
- **与 AI 小专栏不重复**：时代脉搏是"宏观引入"，AI 小专栏是"微观深入"
- **必须基于真实数据**：agent 写此段落时应优先读取 `chapters/week_XX/.research_cache.md` 研究缓存，不足时使用 **WebSearch**（内置工具）查证事实，备选 **perplexity MCP** / **WebFetch**。**绝对禁止编造统计数据和参考链接**。如果搜索不可用，用模糊表述（如"超过千万开发者"）代替精确数字
- **年份必须准确**：先读 `shared/current_date.txt` 获取当前日期，"近 1-2 年"基于当前年份往回推算。**禁止直接抄示例中的年份**——示例仅供参考结构和语气

示例（仅供参考结构和语气，**年份和数据请用 WebSearch 查最新的**）：

> {当前年份} 年，GitHub Copilot 的月活开发者突破 XXX 万，AI 一天能生成的代码量超过许多程序员一年的产出。有人说"学编程已经没用了"——但事实恰恰相反。就像自动驾驶时代你仍然需要理解交通规则，AI 写代码的时代，读懂代码反而更重要了。本周，你将写下人生中的第一行 Python 代码。这不只是一句 `print("Hello")`，而是你和计算机之间对话的起点。

### 完整章首格式

```text
# Week XX：标题

> "引言格言内容"
> — 作者

时代脉搏段落（200-300 字，场景化导入，连接 AI/技术趋势与本章主题）...

---

## 本章学习目标
...
```

---

## 写作元数据注释规范

CHAPTER.md 中有两类内容：**读者内容**和**写作元数据**。写作元数据是 agent 在规划/写作过程中产生的中间产物，**必须**用 HTML 注释 `<!-- ... -->` 包裹，绝不能出现在渲染后的正文中。

### 必须注释的元数据（`<!-- ... -->` 包裹）

| 元数据类型 | 常见标题 | 为什么不能给读者看 |
|-----------|---------|-------------------|
| Bloom 层次标注 | `**Bloom 层次**：记忆 + 理解` | 教学设计术语，读者无需理解 |
| 概念预算表 | `## 本章新概念（预算：X 个）` | 写作过程的认知负荷内控 |
| AI 专栏规划 | `## AI 小专栏规划` | 规划阶段的侧栏选题草案 |
| 角色出场规划 | `## 循环角色出场规划` | 规划阶段的角色调度表 |
| 章节结构骨架 | `## 章节结构` | 规划阶段的结构大纲标题 |
| 锚点规划 | `锚点规划（供 ANCHORS.yml 参考）` | 给 consistency-editor 的内部参考 |
| 每节写作提示 | 节标题下方的学习目标/Bloom/叙事入口 | 给 chapter-writer 的写作提示 |

### 注释格式示例

```html
<!--
认知负荷预算：
- 本周新概念（4 个，预算上限 4 个）：...
- 结论：✅ 在预算内

角色出场规划：
- 小北（第 3 节）：用 input() 时犯类型错误
- 阿码（第 5 节）：追问变量命名规则
-->
```

### 不应注释的内容（读者可见）

- 章首导入（引言格言 + 时代脉搏）
- 本章学习目标
- 贯穿案例介绍和演进路线
- 正文所有章节（`## 第 X 节` / `### 子节`）
- AI 时代小专栏（正式版，非规划版）
- PyHelper 进度
- Git 本周要点
- 本周小结
- Definition of Done（学生自测清单）

---

## Markdown 规范

- 章节标题：`# week_XX：标题`（目录名也是 `week_XX/`）
- 小节用 `##`，子节用 `###`，避免跳级
- 小节标题用**动词/疑问句式**，不用干巴巴的概念名词
  - ❌ "变量与赋值"  ✅ "让程序记住东西"
  - ❌ "输入与输出"  ✅ "跟用户聊起来"
- 代码块必须标注语言：```python / ```bash / ```text

## 代码示例规范

- 示例优先放 `examples/`，正文只引用关键片段或给出运行命令。
- 代码不能孤零零地出现。前面要有"为什么写这段代码"，后面要有"运行后会看到什么"。
- 每个例子要说明：
  - 输入是什么
  - 输出是什么
  - 常见错误是什么（至少 1 个，在叙事中自然出现）

## 术语规范

- 首次出现：中文 + （英文）
- 需要统一写法的术语必须入 `TERMS.yml` 并合入 `shared/glossary.yml`

## 周间衔接

- 每周 CHAPTER.md 末尾必须有"## 本周小结（供下周参考）"段落（2-3 句话概括核心内容 + 展望下周）。
- 非 week_01 的 CHAPTER.md 开头应有"前情提要"过渡段（2-4 句话自然带入，不要机械复制上周小结）。
- 详见 `shared/week_summary_template.md`。

## 图表（可选）

能用短代码或伪代码表达就不要画复杂图。必须画图时，优先 Mermaid。

## Git 本周要点（固定盒子模板）

每周 `CHAPTER.md` 建议包含以下固定段落（复制后再按本周内容替换）。

```text
## Git 本周要点

本周必会命令：
- git status
- git diff
- git add -A
- git commit -m "draft: ..."
- git log --oneline -n 10

常见坑：
- 只改文件不提交：下周找不到"当时怎么改的"。至少做 draft + verify 两次提交。

Pull Request (PR)：
- Gitea 上也叫 Pull Request，流程等价 GitHub：push 分支 -> 开 PR -> review -> merge。
```

## Context7 技术查证（写作前必做）

Python 语言和生态持续演进，为确保教材中的代码示例和最佳实践是**当前版本**的正确写法，所有写正文的 agent 在动笔前必须使用 **Context7 MCP** 查证本章涉及的核心技术点。

### 查证流程

1. **识别本章核心技术点**：从规划阶段的章节结构中提取本章涉及的 Python 特性、标准库模块、第三方库等
2. **调用 Context7 MCP**：
   - 先用 `resolve-library-id` 定位相关库（如 `python`、`pytest`、`argparse` 等）
   - 再用 `query-docs` 查询具体的最佳实践和 API 用法
3. **将查证结果融入写作**：确保代码示例遵循当前 Python 版本的推荐写法

### 典型查证场景

| 周次 | 查证内容 | Context7 查询示例 |
|------|---------|------------------|
| Week 01 | print/input 最新用法 | `query: "Python print function best practices"` |
| Week 04 | 字典/列表最新特性 | `query: "Python dict comprehension modern usage"` |
| Week 08 | pytest 最新 API | `query: "pytest fixtures and parametrize"` |
| Week 10 | JSON 处理最佳实践 | `query: "Python json module best practices"` |
| Week 12 | argparse 现代替代方案 | `query: "Python CLI argparse vs click vs typer"` |

### 注意事项

- 如果 Context7 返回的信息与你已知的内容一致，不需要特别标注
- 如果发现有更新的推荐写法，必须采用新写法并在正文中自然提及
- 如果某个特性有版本要求（如 `match` 语句需要 Python 3.10+），必须在正文中注明

---

## AI 时代小专栏（每章必须）

目的：给初学者一个"时代背景"，理解近两年 AI 对编程方式的影响。好的侧栏能让读者觉得"学这些东西是有现实意义的"，而不是在做脱离时代的练习。

### ⚠️ 参考链接真实性（最高优先级铁律）

**绝对禁止编造参考链接和统计数据。** 所有数据和 URL 必须来自搜索工具的真实返回结果。

- **禁止凭记忆拼 URL**（AI 模型记忆中的 URL 极不可靠）
- **禁止伪造学术论文链接**（如虚构的 arxiv 编号）
- **禁止伪造新闻/报告链接**（如虚构的 Nature、Stanford 研究 URL）
- 宁可不附参考链接（写 `<!-- TODO: 需搜索补充 -->`），也不能附虚假链接
- **推荐搜索工具**（按优先级）：**研究缓存** `.research_cache.md` > **WebSearch**（内置，最可靠）> **perplexity MCP**（AI 增强搜索）> **WebFetch**（网页读取验证）> **Context7 MCP**（技术文档查证）

### 数量与位置（硬约束）

- 每章 **2 个**侧栏，每个 200-500 字。
- **位置分布**：
  - 第 1 个：放在**第 1-2 节之后**（章节前段），让读者一开始就感受到时代背景。
  - 第 2 个：放在**第 3-4 节之间**（章节中段），在读者有一定知识积累后深入讨论。
  - **禁止全部堆在章末。** 侧栏的作用是调节阅读节奏、制造"喘息点"，放在末尾等于浪费。

### 内容要求

- 必须和**相邻小节的主题**有连接点（不是泛泛的"AI 和编程"）。
- 优先使用**有数据、有出处的事实**（而非观点）。搜索关键词参考：GitHub Copilot 统计、Python 语言排名、vibe coding、AI 代码安全性等。
- 涉及事实性表述时，给 2-5 条参考链接 + 访问日期。**所有链接必须来自搜索工具返回的真实 URL**。
- **写侧栏的 agent 必须使用搜索工具**获取最新数据。优先读取 **研究缓存** `chapters/week_XX/.research_cache.md`（Lead agent 预搜索的成果），不足时使用 **WebSearch**（内置搜索，最可靠），其次 **perplexity MCP**（AI 增强搜索），还可用 **WebFetch** 读取和验证网页。如果所有搜索工具都不可用，写 `<!-- TODO: 需联网搜索 "[具体搜索词]" 补充数据和真实参考链接 -->`，**绝不编造**。

### 语气

- 像教材里的"阅读材料"或"课外延伸"，不是新闻稿。
- 可以有观点，但观点要有数据支撑。
- 结尾用一句话回扣当前学习内容（"所以你刚学的 XXX，在 AI 时代其实更重要了"）。

### 格式

```text
> **AI 时代小专栏：标题**
>
> ...（200-500 字，连接相邻小节主题）
>
> 参考（访问日期：{从 shared/current_date.txt 读取的实际日期}）：
> - https://...（必须来自 WebSearch/perplexity MCP 搜索或 .research_cache.md 中的真实 URL，禁止编造）
```

**时效性提醒**：`YYYY-MM-DD` 必须填写 `shared/current_date.txt` 中的实际日期，不要凭记忆或复制旧日期。
